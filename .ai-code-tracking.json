{
  "version": "1.0",
  "records": [
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/RagService.java",
      "timestamp": 1765902467679,
      "startOffset": 0,
      "endOffset": 78,
      "codeContent": "package com.greentechinnovators.backend.service;\n\npublic class RagService {\n}\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/RagService.java",
      "timestamp": 1765902471991,
      "startOffset": 47,
      "endOffset": 2604,
      "codeContent": ".ai;\n\nimport com.greentechinnovators.backend.entity.Vehicle; // Exemples\nimport com.greentechinnovators.backend.repository.VehicleRepository;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.ai.document.Document;\nimport org.springframework.ai.embedding.EmbeddingClient;\nimport org.springframework.ai.vectorstore.SimpleVectorStore;\nimport org.springframework.ai.vectorstore.VectorStore;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.stereotype.Service;\n\nimport java.io.File;\nimport java.util.List;\nimport java.util.stream.Collectors;\n\n@Service\n@RequiredArgsConstructor\npublic class RagService {\n\n    private final VehicleRepository vehicleRepository;\n    private final EmbeddingClient embeddingClient; // Kayji mn Spring AI auto\n\n    // Hada howa l-mini database dyal l-AI (Fichier JSON)\n    private SimpleVectorStore vectorStore;\n\n    @Bean\n    public VectorStore vectorStore() {\n        this.vectorStore \u003d new SimpleVectorStore(embeddingClient);\n        // Charge l-fichier ila kan dej kayna (Persistence)\n        File file \u003d new File(\"src/main/resources/vector_store.json\");\n        if (file.exists()) {\n            this.vectorStore.load(file);\n        }\n        return this.vectorStore;\n    }\n\n    /**\n     * √âTAPE 1 : INGESTION (Dirha marra we7da aw mli tzid data)\n     * Hada kayjib data mn MongoDB w kay7wlha l Vectors\n     */\n    public void loadDataToVectorStore() {\n        // 1. Jib Data mn Repositories\n        List\u003cVehicle\u003e vehicles \u003d vehicleRepository.findAll();\n\n        // 2. 7welha l Documents (Text chunks)\n        List\u003cDocument\u003e documents \u003d vehicles.stream().map(v -\u003e {\n            String content \u003d \"V√©hicule: \" + v.getModel() + \n                             \", Matricule: \" + v.getLicensePlate() + \n                             \", Chauffeur: \" + (v.getUser() !\u003d null ? v.getUser().getName() : \"Aucun\");\n            \n            // Metadata (Moufida l filtrage mn b3d)\n            return new Document(content);\n        }).collect(Collectors.toList());\n\n        // 3. Khzenha f Vector Store\n        vectorStore.add(documents);\n        \n        // 4. Save f fichier (bach mat3awdch koul marra)\n        vectorStore.save(new File(\"src/main/resources/vector_store.json\"));\n        System.out.println(\"‚úÖ Data Ingested \u0026 Saved to Vector Store!\");\n    }\n\n    /**\n     * √âTAPE 2 : SEARCH (Retrieval)\n     */\n    public List\u003cDocument\u003e searchSimilarData(String userQuery) {\n        // Kay9elleb 3la a9rab 3 documents l so2al dyal l-user\n        return vectorStore.similaritySearch(userQuery);\n    }\n}",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 71
    },
    {
      "filePath": "/RagService.java",
      "timestamp": 1765902482100,
      "startOffset": 777,
      "endOffset": 797,
      "codeContent": "IntellijIdeaRulezzz ",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/ChatService.java",
      "timestamp": 1765902534453,
      "startOffset": 0,
      "endOffset": 1942,
      "codeContent": "package com.greentechinnovators.backend.service;\n\nimport com.greentechinnovators.backend.service.ai.AiContextManager;\nimport com.greentechinnovators.backend.service.ai.DeepSeekClient;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.stereotype.Service;\nimport reactor.core.publisher.Flux;\n\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.Map;\n\n@Service\n@RequiredArgsConstructor\npublic class ChatService {\n\n    private final AiContextManager contextManager;\n    private final DeepSeekClient deepSeekClient;\n\n    private static final String SYSTEM_PROMPT_TEMPLATE \u003d \"\"\"\n    Tu es l\u0027assistant IA de \u0027GreenTech Innovators\u0027.\n    \n    üö® R√îLE \u0026 LANGUE :\n    - Tu es un expert en efficacit√© √©nerg√©tique et d√©veloppement durable.\n    - Tu parles par d√©faut en Fran√ßais.\n    - ‚úÖ SI l\u0027utilisateur te parle en Darija (Marocain) ou demande \"bdarija\", TU DOIS r√©pondre en Darija.\n    \n    üìù R√àGLES DE FORMATAGE (R√âPONSE COURTE ET CLAIRE):\n    1. **Structure :** Utilise des sauts de ligne (\\\\n) pour s√©parer chaque id√©e.\n    2. **Titres :** Utilise **Titre** pour les titres.\n    3. **Listes :** Utilise des tirets (\"- \").\n    4. **Simplicit√© :** √âvite les caract√®res sp√©ciaux inutiles.\n    \n    ‚ÑπÔ∏è CONTEXTE DU PROJET :\n    - Objectif : -20%% co√ªts, -50%% CO2 d\u0027ici 2030.\n    \n    üìä DONN√âES TEMPS R√âEL (Mois courant vs Mois dernier) :\n    %s\n    \n    ‚õî INTERDICTIONS :\n    1. Pas de code informatique.\n    2. Pas d\u0027hallucination sur les chiffres (utilise le JSON fourni).\n    \"\"\";\n\n    public Flux\u003cString\u003e askAIStream(String userMessage, List\u003cMap\u003cString, String\u003e\u003e history) {\n        String jsonContext \u003d contextManager.getGlobalContextJson();\n\n        String systemPrompt \u003d String.format(SYSTEM_PROMPT_TEMPLATE, jsonContext);\n\n        List\u003cMap\u003cString, String\u003e\u003e messages \u003d new ArrayList\u003c\u003e();\n        messages.add(Map.of(\"role\", \"system\", \"content\", systemPrompt));\n        if (history !\u003d null) messages.addAll(history",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 52
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/ChatService.java",
      "timestamp": 1765902550987,
      "startOffset": 223,
      "endOffset": 285,
      "codeContent": "import org.springframework.data.mongodb.core.mapping.Document;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/ChatService.java",
      "timestamp": 1765902553000,
      "startOffset": 442,
      "endOffset": 477,
      "codeContent": "import java.util.stream.Collectors;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "/ChatService.java",
      "timestamp": 1765902555027,
      "startOffset": 951,
      "endOffset": 971,
      "codeContent": "IntellijIdeaRulezzz ",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/controller/AiConfigController.java",
      "timestamp": 1765902573367,
      "startOffset": 0,
      "endOffset": 89,
      "codeContent": "package com.greentechinnovators.backend.controller;\n\npublic class AiConfigController {\n}\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/controller/AiConfigController.java",
      "timestamp": 1765902578631,
      "startOffset": 0,
      "endOffset": 327,
      "codeContent": "@RestController\n@RequestMapping(\"/api/ai\")\n@RequiredArgsConstructor\npublic class AiConfigController {\n\n    private final RagService ragService;\n\n    @PostMapping(\"/ingest\")\n    public String ingestData() {\n        ragService.loadDataToVectorStore();\n        return \"Donn√©es charg√©es dans le Vector Store avec succ√®s !\";\n    }\n}",
      "aiProbability": 70,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 13
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/controller/AiConfigController.java",
      "timestamp": 1765902580466,
      "startOffset": 1,
      "endOffset": 41,
      "codeContent": "org.springframework.web.bind.annotation.",
      "aiProbability": 70,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/controller/AiConfigController.java",
      "timestamp": 1765902580504,
      "startOffset": 0,
      "endOffset": 62,
      "codeContent": "import org.springframework.web.bind.annotation.RestController;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/controller/AiConfigController.java",
      "timestamp": 1765902582086,
      "startOffset": 0,
      "endOffset": 38,
      "codeContent": "import lombok.RequiredArgsConstructor;",
      "aiProbability": 70,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/controller/AiConfigController.java",
      "timestamp": 1765902584139,
      "startOffset": 39,
      "endOffset": 98,
      "codeContent": "import org.springframework.web.bind.annotation.PostMapping;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/controller/AiConfigController.java",
      "timestamp": 1765902585881,
      "startOffset": 284,
      "endOffset": 324,
      "codeContent": "com.greentechinnovators.backend.service.",
      "aiProbability": 70,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/controller/AiConfigController.java",
      "timestamp": 1765902585897,
      "startOffset": 0,
      "endOffset": 58,
      "codeContent": "import com.greentechinnovators.backend.service.RagService;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/controller/AiConfigController.java",
      "timestamp": 1765902589394,
      "startOffset": 158,
      "endOffset": 220,
      "codeContent": "import org.springframework.web.bind.annotation.RequestMapping;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "/AiConfigController.java",
      "timestamp": 1765902591925,
      "startOffset": 0,
      "endOffset": 51,
      "codeContent": "package com.greentechinnovators.backend.controller;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/controller/AiConfigController.java",
      "timestamp": 1765902591937,
      "startOffset": 0,
      "endOffset": 53,
      "codeContent": "package com.greentechinnovators.backend.controller;\n\n",
      "aiProbability": 70,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 3
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/controller/AiController.java",
      "timestamp": 1765902840491,
      "startOffset": 294,
      "endOffset": 2796,
      "codeContent": "*;\nimport com.greentechinnovators.backend.service.ai.RagService; // Import RagService\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.ai.document.Document; // Import Document\nimport org.springframework.http.MediaType;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.bind.annotation.*;\nimport reactor.core.publisher.Flux;\n\nimport java.util.List;\nimport java.util.Map;\n\n@RestController\n@RequestMapping(\"/api/ai\")\n@RequiredArgsConstructor // üëà Lombok is enough for constructor injection\npublic class AiController {\n\n    private final ChatService aiService;\n    private final PredictionService generatePredictions;\n    private final RecommendationService recommendationService;\n    private final AiAlertService aiAlertService;\n    \n    // üëá ÿ≤ÿØÿ™ ŸÑŸäŸÉ ŸáÿßÿØ ÿßŸÑÿ¨Ÿàÿ¨ ÿ®ÿßÿ¥ ÿ™Ÿäÿ≥ÿ™Ÿä RAG\n    private final RagService ragService; \n\n    // --- 1. RAG Ingestion (ÿ¥ÿßÿ±ÿ¨Ÿä ÿßŸÑÿØÿßÿ™ÿß) ---\n    @PostMapping(\"/ingest\")\n    public String ingestData() {\n        ragService.loadDataToVectorStore();\n        return \"‚úÖ Donn√©es charg√©es dans le Vector Store avec succ√®s !\";\n    }\n\n    // --- 2. RAG Verification (ÿ™ÿ£ŸÉÿØ Ÿàÿßÿ¥ ÿßŸÑÿØÿßÿ™ÿß ŸÉÿßŸäŸÜÿ©) - NEW ---\n    @GetMapping(\"/search\")\n    public List\u003cString\u003e testSearch(@RequestParam(defaultValue \u003d \"test\") String query) {\n        // ŸáÿßÿØŸä ŸÉÿ™ÿ±ÿ¨ÿπ ŸÑŸäŸÉ ÿßŸÑŸÜÿµŸàÿµ ÿßŸÑŸÑŸä ŸÑŸÇÿßŸáÿß ÿßŸÑŸÄ AI ŸÅÿßŸÑÿØÿßÿ™ÿßÿ®Ÿäÿ≤ ÿØŸäÿßŸÑŸà\n        return ragService.searchSimilarData(query).stream()\n                .map(Document::getContent)\n                .toList();\n    }\n\n    // --- 3. Chat Stream (ÿßŸÑÿ¥ÿßÿ™) ---\n    @PostMapping(value \u003d \"/chat/stream\", produces \u003d MediaType.TEXT_EVENT_STREAM_VALUE)\n    public Flux\u003cString\u003e chatStream(@RequestBody Map\u003cString, Object\u003e payload) {\n        String userMessage \u003d (String) payload.get(\"message\");\n        List\u003cMap\u003cString, String\u003e\u003e history \u003d (List\u003cMap\u003cString, String\u003e\u003e) payload.get(\"history\");\n\n        return aiService.askAIStream(userMessage, history);\n    }\n\n    // --- Other Endpoints ---\n    @GetMapping(\"/predictions\")\n    public PredictionResponse getPredictions() {\n        return generatePredictions.generatePredictions();\n    }\n\n    @GetMapping(\"/recommendations\")\n    public ResponseEntity\u003cRecommendationResponse\u003e getRecommendations() {\n        return ResponseEntity.ok(recommendationService.generateRecommendations());\n    }\n\n    @GetMapping(\"/alerts\")\n    public ResponseEntity\u003cList\u003cAiAlertDTO\u003e\u003e getAiGeneratedAlerts() {\n        List\u003cAiAlertDTO\u003e alerts \u003d aiAlertService.generateSmartAlerts();\n        return ResponseEntity.ok(alerts);\n    }\n}",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 67
    },
    {
      "filePath": "/AiController.java",
      "timestamp": 1765902844898,
      "startOffset": 1138,
      "endOffset": 1158,
      "codeContent": "IntellijIdeaRulezzz ",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/controller/AiController.java",
      "timestamp": 1765902845768,
      "startOffset": 297,
      "endOffset": 355,
      "codeContent": "import com.greentechinnovators.backend.service.RagService;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/security/AppUserDetails.java",
      "timestamp": 1765903252348,
      "startOffset": 1159,
      "endOffset": 1229,
      "codeContent": "@Override\n    public boolean isEnabled() {\n        return false;\n    }",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 4
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/RagService.java",
      "timestamp": 1765903620852,
      "startOffset": 590,
      "endOffset": 645,
      "codeContent": "import org.springframework.ai.embedding.EmbeddingModel;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/RagService.java",
      "timestamp": 1765904445373,
      "startOffset": 96,
      "endOffset": 3596,
      "codeContent": "*;\nimport com.greentechinnovators.backend.repository.*;\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.document.Document;\nimport org.springframework.ai.embedding.EmbeddingModel;\nimport org.springframework.ai.vectorstore.SimpleVectorStore;\nimport org.springframework.ai.vectorstore.VectorStore;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.stereotype.Service;\n\nimport java.io.File;\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.stream.Collectors;\n\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RagService {\n\n    // 1. Injecter ga3 les Repositories li bghiti tqrahom\n    private final VehicleRepository vehicleRepository;\n    private final UserRepository userRepository;\n    // private final SensorRepository sensorRepository; // Ila kan 3ndk\n    // private final DepartmentRepository departmentRepository; // Ila kan 3ndk\n    \n    private final EmbeddingModel embeddingModel;\n    private SimpleVectorStore vectorStore;\n\n    @Bean\n    public VectorStore vectorStore() {\n        this.vectorStore \u003d new SimpleVectorStore(embeddingModel);\n        File file \u003d new File(\"src/main/resources/vector_store.json\");\n        if (file.exists()) {\n            this.vectorStore.load(file);\n            log.info(\"üìÇ Vector Store charg√©.\");\n        }\n        return this.vectorStore;\n    }\n\n    public void loadDataToVectorStore() {\n        log.info(\"üîÑ D√©but de l\u0027ingestion de TOUTE la base de donn√©es...\");\n        \n        // Hna ghadi njm3o kolchi\n        List\u003cDocument\u003e allDocuments \u003d new ArrayList\u003c\u003e();\n\n        // --- 1. CHARGER LES V√âHICULES ---\n        List\u003cVehicle\u003e vehicles \u003d vehicleRepository.findAll();\n        List\u003cDocument\u003e vehicleDocs \u003d vehicles.stream().map(v -\u003e {\n            String content \u003d \"Type: V√©hicule, Mod√®le: \" + v.getModel() +\n                    \", Matricule: \" + v.getLicensePlate() +\n                    \", Chauffeur: \" + (v.getUser() !\u003d null ? v.getUser().getName() : \"Aucun\");\n            return new Document(content);\n        }).toList();\n        allDocuments.addAll(vehicleDocs);\n        log.info(\"üöó Ajout√© \" + vehicleDocs.size() + \" v√©hicules.\");\n\n        // --- 2. CHARGER LES UTILISATEURS (USERS) ---\n        List\u003cUser\u003e users \u003d userRepository.findAll();\n        List\u003cDocument\u003e userDocs \u003d users.stream().map(u -\u003e {\n            String content \u003d \"Type: Utilisateur, Nom: \" + u.getName() +\n                    \", Email: \" + u.getEmail() +\n                    \", R√¥le: \" + u.getRole(); \n            return new Document(content);\n        }).toList();\n        allDocuments.addAll(userDocs);\n        log.info(\"üë§ Ajout√© \" + userDocs.size() + \" utilisateurs.\");\n\n        /* // --- 3. CHARGER LES CAPTEURS (EXEMPLE) ---\n        List\u003cSensor\u003e sensors \u003d sensorRepository.findAll();\n        List\u003cDocument\u003e sensorDocs \u003d sensors.stream().map(s -\u003e {\n            String content \u003d \"Type: Capteur, Nom: \" + s.getName() + \", Valeur: \" + s.getValue();\n            return new Document(content);\n        }).toList();\n        allDocuments.addAll(sensorDocs);\n        */\n\n        // --- SAUVEGARDE FINALE ---\n        if (allDocuments.isEmpty()) {\n            log.warn(\"‚ö†Ô∏è Aucune donn√©e trouv√©e dans la base !\");\n            return;\n        }\n\n        vectorStore.add(allDocuments);\n        \n        File file \u003d new File(\"src/main/resources/vector_store.json\");\n        vectorStore.save(file);\n        log.info(\"‚úÖ SUCC√àS : \" + allDocuments.size() + \" documents charg√©s et sauvegard√©s !\"",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 89
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/RagService.java",
      "timestamp": 1765905182342,
      "startOffset": 151,
      "endOffset": 6758,
      "codeContent": " \nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.document.Document;\nimport org.springframework.ai.embedding.EmbeddingModel;\nimport org.springframework.ai.vectorstore.SimpleVectorStore;\nimport org.springframework.ai.vectorstore.VectorStore;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.stereotype.Service;\n\nimport java.io.File;\nimport java.util.ArrayList;\nimport java.util.List;\n\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RagService {\n\n    // 1. Inject Repositories\n    private final DepartmentRepository departmentRepository;\n    private final EnergyMonitorRepository energyMonitorRepository;\n    private final GasMonitorRepository gasMonitorRepository;\n    private final TrashMonitorRepository trashMonitorRepository;\n    private final UserRepository userRepository;\n    private final VehicleRepository vehicleRepository;\n    private final SmartDataRepository smartDataRepository; \n\n    private final EmbeddingModel embeddingModel;\n    private SimpleVectorStore vectorStore;\n\n    @Bean\n    public VectorStore vectorStore() {\n        this.vectorStore \u003d new SimpleVectorStore(embeddingModel);\n        File file \u003d new File(\"src/main/resources/vector_store.json\");\n        if (file.exists()) {\n            this.vectorStore.load(file);\n            // üìÇ Log message in English\n            log.info(\"üìÇ Vector Store successfully loaded from file.\");\n        }\n        return this.vectorStore;\n    }\n\n    public void loadDataToVectorStore() {\n        // üîÑ Log message in English\n        log.info(\"üîÑ Starting ingestion of all data from MongoDB...\");\n        \n        List\u003cDocument\u003e allDocuments \u003d new ArrayList\u003c\u003e();\n\n        // ----------------------------------------------------\n        // A. STATIC CONTEXT (Department, Users, Vehicles)\n        // ----------------------------------------------------\n\n        // 1. Departments\n        List\u003cDepartment\u003e departments \u003d departmentRepository.findAll();\n        List\u003cDocument\u003e departmentDocs \u003d departments.stream().map(d -\u003e {\n            String usersList \u003d d.getUsers().stream()\n                .map(User::getName)\n                .reduce(\"\", (a, b) -\u003e a.isEmpty() ? b : a + \", \" + b);\n            \n            // Content in English\n            String content \u003d \"Department: \" + d.getName() + \n                             \", Employees: \" + (usersList.isEmpty() ? \"None\" : usersList);\n            return new Document(content);\n        }).toList();\n        allDocuments.addAll(departmentDocs);\n\n        // 2. Users\n        List\u003cUser\u003e users \u003d userRepository.findAll();\n        List\u003cDocument\u003e userDocs \u003d users.stream().map(u -\u003e {\n            // Content in English\n            String content \u003d \"User: \" + u.getName() + \n                             \", Email: \" + u.getEmail() +\n                             \", Job Title: \" + u.getJobTitle() +\n                             \", Role: \" + u.getRole().name();\n            return new Document(content);\n        }).toList();\n        allDocuments.addAll(userDocs);\n\n        // 3. Vehicles\n        List\u003cVehicle\u003e vehicles \u003d vehicleRepository.findAll();\n        List\u003cDocument\u003e vehicleDocs \u003d vehicles.stream().map(v -\u003e {\n            String driver \u003d (v.getUser() !\u003d null) ? v.getUser().getName() : \"Unassigned\";\n            // Content in English\n            String content \u003d \"Vehicle: \" + v.getModel() +\n                             \", License Plate: \" + v.getLicensePlate() +\n                             \", Assigned Driver: \" + driver;\n            return new Document(content);\n        }).toList();\n        allDocuments.addAll(vehicleDocs);\n\n        // ----------------------------------------------------\n        // B. MONITORING DATA (Sensor Readings)\n        // ----------------------------------------------------\n        \n        // 4. Energy Monitors\n        List\u003cEnergyMonitor\u003e energyMonitors \u003d energyMonitorRepository.findAll();\n        List\u003cDocument\u003e energyMonitorDocs \u003d energyMonitors.stream().map(m -\u003e {\n            // Content in English\n            String content \u003d \"Energy Monitor: Location \" + m.getLocation() + \n                             \", Device Status: \" + m.getStatus() + \n                             \", CO2 Footprint Estimate: \" + m.getCo2Impact() + \" kg.\";\n            return new Document(content);\n        }).toList();\n        allDocuments.addAll(energyMonitorDocs);\n\n        // 5. Gas Monitors\n        List\u003cGasMonitor\u003e gasMonitors \u003d gasMonitorRepository.findAll();\n        List\u003cDocument\u003e gasMonitorDocs \u003d gasMonitors.stream().map(m -\u003e {\n            // Content in English\n            String content \u003d \"Gas Monitor: Location \" + m.getLocation() + \n                             \", Device Status: \" + m.getStatus() + \n                             \", CO2 Footprint Estimate: \" + m.getCo2Impact() + \" kg.\";\n            return new Document(content);\n        }).toList();\n        allDocuments.addAll(gasMonitorDocs);\n        \n        // 6. Trash Monitors\n        List\u003cTrashMonitor\u003e trashMonitors \u003d trashMonitorRepository.findAll();\n        List\u003cDocument\u003e trashMonitorDocs \u003d trashMonitors.stream().map(m -\u003e {\n            // Content in English\n            String content \u003d \"Trash Monitor: Location \" + m.getLocation() + \n                             \", Waste Type: \" + m.getTrashType() + \n                             \", CO2 Footprint Estimate: \" + m.getCo2Impact() + \" kg.\";\n            return new Document(content);\n        }).toList();\n        allDocuments.addAll(trashMonitorDocs);\n\n        // 7. Smart Data (Aggregated Sensor Data)\n        List\u003cSmartData\u003e smartData \u003d smartDataRepository.findAll();\n        List\u003cDocument\u003e smartDataDocs \u003d smartData.stream().map(s -\u003e {\n            // Content in English\n            String content \u003d \"Smart Consumption Data: Type \" + s.getDataType() + \n                             \", Value: \" + s.getValue() + \" \" + s.getUnit() +\n                             \", Location: \" + s.getLocation() +\n                             \", CO2 Footprint: \" + s.getCo2Impact() + \" kg.\";\n            return new Document(content);\n        }).toList();\n        allDocuments.addAll(smartDataDocs);\n\n\n        // --- FINAL SAVE ---\n        if (allDocuments.isEmpty()) {\n            // ‚ö†Ô∏è Warning in English\n            log.warn(\"‚ö†Ô∏è No data found to read! Ensure MongoDB contains documents.\");\n            return;\n        }\n\n        vectorStore.add(allDocuments);\n        \n        File file \u003d new File(\"src/main/resources/vector_store.json\");\n        vectorStore.save(file);\n        // ‚úÖ Success Log in English\n        log.info(\"‚úÖ SUCCESS: Loaded and saved \" + allDocuments.size() + \" documents.",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 154
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/config/DataInitializer.java",
      "timestamp": 1765905276824,
      "startOffset": 0,
      "endOffset": 82,
      "codeContent": "package com.greentechinnovators.backend.config;\n\npublic class DataInitializer {\n}\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/config/DataInitializer.java",
      "timestamp": 1765905281384,
      "startOffset": 47,
      "endOffset": 1130,
      "codeContent": " // üëà Choisissez votre package\n\nimport com.greentechinnovators.backend.service.RagService;\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.boot.context.event.ApplicationReadyEvent;\nimport org.springframework.context.event.EventListener;\nimport org.springframework.stereotype.Component;\n\n@Component\n@RequiredArgsConstructor\n@Slf4j\npublic class DataInitializer {\n\n    private final RagService ragService;\n\n    /**\n     * Cette m√©thode est ex√©cut√©e automatiquement par Spring Boot \n     * juste apr√®s que l\u0027Application Context soit enti√®rement charg√© (ready).\n     */\n    @EventListener(ApplicationReadyEvent.class)\n    public void runIngestionOnStartup() {\n        log.info(\"üöÄ D√©clenchement automatique de l\u0027ingestion RAG au d√©marrage...\");\n        try {\n            ragService.loadDataToVectorStore();\n            log.info(\"‚úÖ Ingestion RAG termin√©e avec succ√®s au d√©marrage.\");\n        } catch (Exception e) {\n            log.error(\"‚ùå Erreur critique lors de l\u0027ingestion RAG automatique : \" + e.getMessage(), e);\n        }\n    }\n}",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 31
    },
    {
      "filePath": "/BackendApplication.java",
      "timestamp": 1765906375951,
      "startOffset": 198,
      "endOffset": 218,
      "codeContent": "IntellijIdeaRulezzz ",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/BackendApplication.java",
      "timestamp": 1765906377305,
      "startOffset": 161,
      "endOffset": 222,
      "codeContent": "import org.springframework.scheduling.annotation.EnableAsync;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "/RagService.java",
      "timestamp": 1765906399877,
      "startOffset": 666,
      "endOffset": 686,
      "codeContent": "IntellijIdeaRulezzz ",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/RagService.java",
      "timestamp": 1765906400904,
      "startOffset": 661,
      "endOffset": 703,
      "codeContent": "org.springframework.scheduling.annotation.",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/RagService.java",
      "timestamp": 1765906400916,
      "startOffset": 498,
      "endOffset": 553,
      "codeContent": "import org.springframework.scheduling.annotation.Async;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "/RagService.java",
      "timestamp": 1765906892011,
      "startOffset": 6387,
      "endOffset": 6407,
      "codeContent": "IntellijIdeaRulezzz ",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "/RagService.java",
      "timestamp": 1765906892012,
      "startOffset": 497,
      "endOffset": 553,
      "codeContent": "\nimport org.springframework.scheduling.annotation.Async;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 2
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/repository/EnergyRepository.java",
      "timestamp": 1765909153638,
      "startOffset": 1564,
      "endOffset": 1661,
      "codeContent": "public interface DailyStatProjection {\n        String getDate();\n        Double getTotal();\n    }",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 4
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/repository/GasRepository.java",
      "timestamp": 1765909178970,
      "startOffset": 1495,
      "endOffset": 1593,
      "codeContent": " public interface DailyStatProjection {\n        String getDate();\n        Double getTotal();\n    }",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 4
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/repository/TrashRepository.java",
      "timestamp": 1765909213738,
      "startOffset": 1539,
      "endOffset": 1637,
      "codeContent": " public interface DailyStatProjection {\n        String getDate();\n        Double getTotal();\n    }",
      "aiProbability": 70,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 4
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/repository/VehicleLogRepository.java",
      "timestamp": 1765909225320,
      "startOffset": 1112,
      "endOffset": 1210,
      "codeContent": " public interface DailyStatProjection {\n        String getDate();\n        Double getTotal();\n    }",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 4
    },
    {
      "filePath": "/_Dummy_.java",
      "timestamp": 1765909241386,
      "startOffset": 139,
      "endOffset": 172,
      "codeContent": "java.time.LocalDateTime startDate",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "/_Dummy_.java",
      "timestamp": 1765909244461,
      "startOffset": 139,
      "endOffset": 172,
      "codeContent": "java.time.LocalDateTime startDate",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "/_Dummy_.java",
      "timestamp": 1765909247410,
      "startOffset": 139,
      "endOffset": 172,
      "codeContent": "java.time.LocalDateTime startDate",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/repository/VehicleLogRepository.java",
      "timestamp": 1765909266975,
      "startOffset": 1067,
      "endOffset": 1106,
      "codeContent": "com.greentechinnovators.backend.dto.ai.",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/repository/EnergyRepository.java",
      "timestamp": 1765909269238,
      "startOffset": 1514,
      "endOffset": 1553,
      "codeContent": "com.greentechinnovators.backend.dto.ai.",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/repository/GasRepository.java",
      "timestamp": 1765909270978,
      "startOffset": 1441,
      "endOffset": 1480,
      "codeContent": "com.greentechinnovators.backend.dto.ai.",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/PredictionService.java",
      "timestamp": 1765909291957,
      "startOffset": 4825,
      "endOffset": 4868,
      "codeContent": "com.greentechinnovators.backend.repository.",
      "aiProbability": 70,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/dto/DailyStatProjection.java",
      "timestamp": 1765909330578,
      "startOffset": 0,
      "endOffset": 83,
      "codeContent": "package com.greentechinnovators.backend.dto;\n\npublic class DailyStatProjection {\n}\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "/DailyStatProjection.java",
      "timestamp": 1765909338590,
      "startOffset": 0,
      "endOffset": 44,
      "codeContent": "package com.greentechinnovators.backend.dto;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/repository/EnergyRepository.java",
      "timestamp": 1765909344081,
      "startOffset": 53,
      "endOffset": 116,
      "codeContent": "import com.greentechinnovators.backend.dto.DailyStatProjection;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/PredictionService.java",
      "timestamp": 1765909349410,
      "startOffset": 102,
      "endOffset": 165,
      "codeContent": "import com.greentechinnovators.backend.dto.DailyStatProjection;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "/_Dummy_.java",
      "timestamp": 1765909377669,
      "startOffset": 156,
      "endOffset": 189,
      "codeContent": "java.time.LocalDateTime startDate",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/repository/GasRepository.java",
      "timestamp": 1765909377755,
      "startOffset": 53,
      "endOffset": 116,
      "codeContent": "import com.greentechinnovators.backend.dto.DailyStatProjection;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/repository/VehicleLogRepository.java",
      "timestamp": 1765909387047,
      "startOffset": 53,
      "endOffset": 116,
      "codeContent": "import com.greentechinnovators.backend.dto.DailyStatProjection;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "/_Dummy_.java",
      "timestamp": 1765909390881,
      "startOffset": 156,
      "endOffset": 189,
      "codeContent": "java.time.LocalDateTime startDate",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/repository/TrashRepository.java",
      "timestamp": 1765909390914,
      "startOffset": 53,
      "endOffset": 116,
      "codeContent": "import com.greentechinnovators.backend.dto.DailyStatProjection;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "/_Dummy_.java",
      "timestamp": 1765909737079,
      "startOffset": 177,
      "endOffset": 210,
      "codeContent": "java.time.LocalDateTime startDate",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "/_Dummy_.java",
      "timestamp": 1765909740480,
      "startOffset": 171,
      "endOffset": 204,
      "codeContent": "java.time.LocalDateTime startDate",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/dto/DailyStatProjection.java",
      "timestamp": 1765909788736,
      "startOffset": 0,
      "endOffset": 83,
      "codeContent": "package com.greentechinnovators.backend.dto;\n\npublic class DailyStatProjection {\n}\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "/DailyStatProjection.java",
      "timestamp": 1765909799034,
      "startOffset": 0,
      "endOffset": 44,
      "codeContent": "package com.greentechinnovators.backend.dto;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/repository/VehicleLogRepository.java",
      "timestamp": 1765910315878,
      "startOffset": 790,
      "endOffset": 1310,
      "codeContent": "\"{ \u0027$match\u0027: { \u0027createdAt\u0027: { \u0027$gte\u0027: ?0 } } }\",\n    // ŸÖÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ™ÿ¨ŸÖŸäÿπ (Group Stage)\n    \"{ \u0027$group\u0027: { \u0027_id\u0027: { $dateToString: { format: \u0027%Y-%m-%d\u0027, date: \u0027$createdAt\u0027 } }, \u0027total\u0027: { \u0027$sum\u0027: \u0027$distanceTravelled\u0027 } } }\",\n\n    // üåü ŸÖÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ¨ÿØŸäÿØÿ© üåü\n    \"{ \u0027$project\u0027: { \" +\n            \"    \u0027_id\u0027: 0, \" + // ÿ≠ÿ∞ŸÅ ÿ≠ŸÇŸÑ _id ÿßŸÑŸÇÿØŸäŸÖ\n            \"    \u0027date\u0027: \u0027$_id\u0027, \" + // ÿ•ÿπÿßÿØÿ© ÿ™ÿ≥ŸÖŸäÿ© _id (ÿßŸÑÿ™ÿßÿ±ŸäÿÆ) ÿ•ŸÑŸâ date\n            \"    \u0027total\u0027: 1 \" + // ÿßŸÑÿßÿ≠ÿ™ŸÅÿßÿ∏ ÿ®ŸÄ total\n            \"} }\",\n    \n    \"{ \u0027$sort\u0027: { \u0027date\u0027: 1 } }\"\n",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 13
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/PredictionService.java",
      "timestamp": 1765910527332,
      "startOffset": 4743,
      "endOffset": 5034,
      "codeContent": "Map\u003cString, Double\u003e statsMap \u003d new HashMap\u003c\u003e();\n    \n    if (dbStats !\u003d null) {\n        // üåü ÿßŸÑÿ™ÿπÿØŸäŸÑ ŸáŸÜÿß: Ÿäÿ¨ÿ® ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ? extends DailyStatProjection ŸÉŸÜŸàÿπ ÿßŸÑÿπŸÜÿµÿ± ŸÅŸä ÿßŸÑÿ≠ŸÑŸÇÿ©\n        for (DailyStatProjection stat : dbStats) {\n            statsMap.put(stat.getDate(), stat.getTotal());\n        }\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 8
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/PredictionService.java",
      "timestamp": 1765910539244,
      "startOffset": 4743,
      "endOffset": 5034,
      "codeContent": "Map\u003cString, Double\u003e statsMap \u003d new HashMap\u003c\u003e();\n    \n    if (dbStats !\u003d null) {\n        // üåü ÿßŸÑÿ™ÿπÿØŸäŸÑ ŸáŸÜÿß: Ÿäÿ¨ÿ® ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ? extends DailyStatProjection ŸÉŸÜŸàÿπ ÿßŸÑÿπŸÜÿµÿ± ŸÅŸä ÿßŸÑÿ≠ŸÑŸÇÿ©\n        for (DailyStatProjection stat : dbStats) {\n            statsMap.put(stat.getDate(), stat.getTotal());\n        }\n",
      "aiProbability": 70,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 8
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/repository/VehicleLogRepository.java",
      "timestamp": 1765910908553,
      "startOffset": 413,
      "endOffset": 479,
      "codeContent": "public record Last7DaysStat(\n    String day,\n    Double value\n) {}",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 4
    },
    {
      "filePath": "/_Dummy_.java",
      "timestamp": 1765910961797,
      "startOffset": 166,
      "endOffset": 199,
      "codeContent": "java.time.LocalDateTime startDate",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/repository/VehicleLogRepository.java",
      "timestamp": 1765910967816,
      "startOffset": 1100,
      "endOffset": 1136,
      "codeContent": "com.greentechinnovators.backend.dto.",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "/PredictionService.java",
      "timestamp": 1765910975699,
      "startOffset": 4693,
      "endOffset": 4727,
      "codeContent": "ist\u003c? extends DailyStatProjection\u003e",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "/PredictionService.java",
      "timestamp": 1765910975716,
      "startOffset": 4692,
      "endOffset": 4756,
      "codeContent": "com.greentechinnovators.backend.repository.VehicleLogRepository.",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/PredictionService.java",
      "timestamp": 1765910975732,
      "startOffset": 4692,
      "endOffset": 4713,
      "codeContent": "VehicleLogRepository.",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "/PredictionService.java",
      "timestamp": 1765910990952,
      "startOffset": 4697,
      "endOffset": 4761,
      "codeContent": "com.greentechinnovators.backend.repository.VehicleLogRepository.",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/RagService.java",
      "timestamp": 1765911905402,
      "startOffset": 5514,
      "endOffset": 6015,
      "codeContent": " List\u003cTrashMonitor\u003e trashMonitors \u003d trashMonitorRepository.findAll();\n        List\u003cDocument\u003e trashMonitorDocs \u003d trashMonitors.stream().map(m -\u003e {\n            // Content in English\n            String content \u003d \"Trash Monitor: Location \" + m.getLocation() +\n                    \", Waste Type: \" + m.getTrashType() +\n                    \", CO2 Footprint Estimate: \" + m.getCo2Impact() + \" kg.\";\n            return new Document(content);\n        }).toList();\n        allDocuments.addAll(trashMonitorDocs);",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 9
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/RagService.java",
      "timestamp": 1765912317022,
      "startOffset": 3937,
      "endOffset": 3976,
      "codeContent": "com.greentechinnovators.backend.entity.",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/RagService.java",
      "timestamp": 1765912644183,
      "startOffset": 3427,
      "endOffset": 3466,
      "codeContent": "com.greentechinnovators.backend.entity.",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/ChatService.java",
      "timestamp": 1765913250108,
      "startOffset": 1013,
      "endOffset": 1902,
      "codeContent": "Tu es l\u0027assistant IA de \u0027GreenTech Innovators\u0027.\n    \n    üö® R√îLE \u0026 LANGUE :\n    - Tu es un expert en efficacit√© √©nerg√©tique et d√©veloppement durable.\n    - Tu parles par d√©faut en Fran√ßais.\n    - ‚úÖ SI l\u0027utilisateur te parle en Darija (Marocain) ou demande \"bdarija\", TU DOIS r√©pondre en Darija.\n    \n    üìù R√àGLES DE FORMATAGE (R√âPONSE COURTE ET CLAIRE):\n    1. **Structure :** Utilise des sauts de ligne (\\\\n) pour s√©parer chaque id√©e.\n    2. **Titres :** Utilise **Titre** pour les titres.\n    3. **Listes :** Utilise des tirets (\"- \").\n    4. **Simplicit√© :** √âvite les caract√®res sp√©ciaux inutiles.\n    \n    ‚ÑπÔ∏è CONTEXTE DU PROJET :\n    - Objectif : -20%% co√ªts, -50%% CO2 d\u0027ici 2030.\n    \n    üìä DONN√âES TEMPS R√âEL (Mois courant vs Mois dernier) :\n    %s\n    \n    ‚õî INTERDICTIONS :\n    1. Pas de code informatique.\n    2. Pas d\u0027hallucination sur les chiffres (utilise le JSON fourni).\n",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 23
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/PredictionService.java",
      "timestamp": 1765914312033,
      "startOffset": 1424,
      "endOffset": 1471,
      "codeContent": "    private final DeepSeekClient callDeepSeek;\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 2
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/PredictionService.java",
      "timestamp": 1765914333855,
      "startOffset": 102,
      "endOffset": 172,
      "codeContent": "import com.greentechinnovators.backend.controller.DashboardController;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "/PredictionService.java",
      "timestamp": 1765914335076,
      "startOffset": 101,
      "endOffset": 172,
      "codeContent": "\nimport com.greentechinnovators.backend.controller.DashboardController;",
      "aiProbability": 70,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 2
    },
    {
      "filePath": "/PredictionService.java",
      "timestamp": 1765914386240,
      "startOffset": 4049,
      "endOffset": 4132,
      "codeContent": "(java.util.List\u003c? extends com.greentechinnovators.backend.dto.DailyStatProjection\u003e)",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/PredictionService.java",
      "timestamp": 1765914423797,
      "startOffset": 238,
      "endOffset": 312,
      "codeContent": "import com.greentechinnovators.backend.dto.Energy.Responce.DailyEnergyDTO;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "/PredictionService.java",
      "timestamp": 1765914425590,
      "startOffset": 4848,
      "endOffset": 4914,
      "codeContent": "com.greentechinnovators.backend.dto.Energy.Responce.DailyEnergyDTO",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "/PredictionService.java",
      "timestamp": 1765914425591,
      "startOffset": 238,
      "endOffset": 313,
      "codeContent": "import com.greentechinnovators.backend.dto.Energy.Responce.DailyEnergyDTO;\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 2
    },
    {
      "filePath": "/_Dummy_.java",
      "timestamp": 1765914453893,
      "startOffset": 161,
      "endOffset": 189,
      "codeContent": "java.time.LocalDateTime days",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/controller/DashboardController.java",
      "timestamp": 1765914453919,
      "startOffset": 3559,
      "endOffset": 3582,
      "codeContent": "java.time.LocalDateTime",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/controller/DashboardController.java",
      "timestamp": 1765914453943,
      "startOffset": 1034,
      "endOffset": 1065,
      "codeContent": "import java.time.LocalDateTime;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "/PredictionService.java",
      "timestamp": 1765914692388,
      "startOffset": 4839,
      "endOffset": 4950,
      "codeContent": "\n        response.getDechets().setHistory(getHistoryData(dashboardController.getLast7DaysStats(sevenDaysAgo)));",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 2
    },
    {
      "filePath": "/PredictionService.java",
      "timestamp": 1765914869246,
      "startOffset": 4865,
      "endOffset": 4931,
      "codeContent": "com.greentechinnovators.backend.dto.Energy.Responce.DailyEnergyDTO",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "/PredictionService.java",
      "timestamp": 1765914869776,
      "startOffset": 4865,
      "endOffset": 4931,
      "codeContent": "com.greentechinnovators.backend.dto.Energy.Responce.DailyEnergyDTO",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/PredictionService.java",
      "timestamp": 1765915125065,
      "startOffset": 5246,
      "endOffset": 8036,
      "codeContent": "// Ÿäÿ¨ÿ® ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿßÿ≥ÿ™Ÿäÿ±ÿßÿØÿßÿ™ ÿßŸÑÿ™ÿßŸÑŸäÿ© ŸÅŸä ÿ®ÿØÿßŸäÿ© ŸÖŸÑŸÅ PredictionService.java\nimport com.greentechinnovators.backend.dto.gas.responce.DailyGasDTO;\nimport com.greentechinnovators.backend.dto.trash.response.DailyTrashDTO;\n\n// ... (ÿ®ŸÇŸäÿ© ŸÖŸÑŸÅ PredictionService.java)\n\n// ÿßŸÑÿØÿßŸÑÿ© ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ© ŸÑŸÑÿ∑ÿßŸÇÿ© (Energy) - ÿ™ŸÖ ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿßÿ≥ŸÖ Ÿàÿ™Ÿàÿ∂Ÿäÿ≠ ŸÖŸÜÿ∑ŸÇ ÿßŸÑÿ™ÿßÿ±ŸäÿÆ\nprivate List\u003cDouble\u003e getEnergyHistoryData(List\u003ccom.greentechinnovators.backend.dto.Energy.Responce.DailyEnergyDTO\u003e dbStats) {\n    Map\u003cString, Double\u003e statsMap \u003d new HashMap\u003c\u003e();\n\n    if (dbStats !\u003d null) {\n        for (DailyEnergyDTO stat : dbStats) {\n            // ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ getTotalEnergyKwh Ÿàÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸäŸàŸÖ ŸÅŸÇÿ∑\n            statsMap.put(stat.getDate().toLocalDate().toString(), stat.getTotalEnergyKwh());\n        }\n    }\n\n    List\u003cDouble\u003e history \u003d new ArrayList\u003c\u003e();\n    // ÿ™ÿ≠ÿØŸäÿØ ŸÜŸÇÿ∑ÿ© ÿßŸÑÿ®ÿØÿßŸäÿ© (ŸÖŸÜÿ∞ 6 ÿ£ŸäÿßŸÖ ŸÖÿ∂ÿ™ÿå ÿπŸÜÿØ ŸÖŸÜÿ™ÿµŸÅ ÿßŸÑŸÑŸäŸÑ)\n    LocalDateTime dateIter \u003d LocalDateTime.now().minusDays(6).withHour(0).withMinute(0).withSecond(0).withNano(0);\n\n    for (int i \u003d 0; i \u003c 7; i++) {\n        String key \u003d dateIter.toLocalDate().toString();\n        history.add(statsMap.getOrDefault(key, 0.0));\n        dateIter \u003d dateIter.plusDays(1);\n    }\n    return history;\n}\n\n// ÿßŸÑÿØÿßŸÑÿ© ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ© ŸÑŸÑŸÖÿÆŸÑŸÅÿßÿ™ (Trash)\nprivate List\u003cDouble\u003e getTrashHistoryData(List\u003cDailyTrashDTO\u003e dbStats) {\n    Map\u003cString, Double\u003e statsMap \u003d new HashMap\u003c\u003e();\n\n    if (dbStats !\u003d null) {\n        for (DailyTrashDTO stat : dbStats) {\n            // *ŸäŸÅÿ™ÿ±ÿ∂ ÿ£ŸÜ ÿßŸÑÿØÿßŸÑÿ© ŸáŸä stat.getTotalWeight()*\n            statsMap.put(stat.getDate().toLocalDate().toString(), stat.getTotalWeight());\n        }\n    }\n\n    List\u003cDouble\u003e history \u003d new ArrayList\u003c\u003e();\n    LocalDateTime dateIter \u003d LocalDateTime.now().minusDays(6).withHour(0).withMinute(0).withSecond(0).withNano(0);\n\n    for (int i \u003d 0; i \u003c 7; i++) {\n        String key \u003d dateIter.toLocalDate().toString();\n        history.add(statsMap.getOrDefault(key, 0.0));\n        dateIter \u003d dateIter.plusDays(1);\n    }\n    return history;\n}\n\n// ÿßŸÑÿØÿßŸÑÿ© ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ© ŸÑŸÑÿ∫ÿßÿ≤ (Gas)\nprivate List\u003cDouble\u003e getGasHistoryData(List\u003cDailyGasDTO\u003e dbStats) {\n    Map\u003cString, Double\u003e statsMap \u003d new HashMap\u003c\u003e();\n\n    if (dbStats !\u003d null) {\n        for (DailyGasDTO stat : dbStats) {\n            // *ŸäŸÅÿ™ÿ±ÿ∂ ÿ£ŸÜ ÿßŸÑÿØÿßŸÑÿ© ŸáŸä stat.getTotalConsumed()*\n            statsMap.put(stat.getDate().toLocalDate().toString(), stat.getTotalConsumed());\n        }\n    }\n\n    List\u003cDouble\u003e history \u003d new ArrayList\u003c\u003e();\n    LocalDateTime dateIter \u003d LocalDateTime.now().minusDays(6).withHour(0).withMinute(0).withSecond(0).withNano(0);\n\n    for (int i \u003d 0; i \u003c 7; i++) {\n        String key \u003d dateIter.toLocalDate().toString();\n        history.add(statsMap.getOrDefault(key, 0.0));\n        dateIter \u003d dateIter.plusDays(1);\n    }\n    return history;\n}\n\n\n// ... (Ÿäÿ¨ÿ® ÿ™ÿ≠ÿØŸäÿ´ generatePredictions ŸÑÿßÿ≥ÿ™ÿØÿπÿßÿ° Ÿáÿ∞Ÿá ÿßŸÑÿØŸàÿßŸÑ)",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 75
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/PredictionService.java",
      "timestamp": 1765915131135,
      "startOffset": 379,
      "endOffset": 451,
      "codeContent": "import com.greentechinnovators.backend.dto.trash.response.DailyTrashDTO;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "/PredictionService.java",
      "timestamp": 1765915133473,
      "startOffset": 378,
      "endOffset": 451,
      "codeContent": "\nimport com.greentechinnovators.backend.dto.trash.response.DailyTrashDTO;",
      "aiProbability": 70,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 2
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/PredictionService.java",
      "timestamp": 1765915138052,
      "startOffset": 379,
      "endOffset": 447,
      "codeContent": "import com.greentechinnovators.backend.dto.gas.responce.DailyGasDTO;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "/PredictionService.java",
      "timestamp": 1765915139907,
      "startOffset": 378,
      "endOffset": 447,
      "codeContent": "\nimport com.greentechinnovators.backend.dto.gas.responce.DailyGasDTO;",
      "aiProbability": 70,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 2
    },
    {
      "filePath": "/PredictionService.java",
      "timestamp": 1765915158663,
      "startOffset": 4929,
      "endOffset": 4969,
      "codeContent": "(dashboardController.getGasHistory(7)));",
      "aiProbability": 70,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "/PredictionService.java",
      "timestamp": 1765915163442,
      "startOffset": 5358,
      "endOffset": 5400,
      "codeContent": "(dashboardController.getTrashHistory(7)));",
      "aiProbability": 70,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/repository/GasRepository.java",
      "timestamp": 1765918399599,
      "startOffset": 96,
      "endOffset": 1485,
      "codeContent": "ai.DailyStat;\nimport com.greentechinnovators.backend.entity.Gas;\nimport org.springframework.data.mongodb.repository.Aggregation;\nimport org.springframework.data.mongodb.repository.MongoRepository;\nimport org.springframework.stereotype.Repository;\n\nimport java.time.LocalDateTime;\nimport java.util.List;\n\n@Repository\npublic interface GasRepository extends MongoRepository\u003cGas, String\u003e {\n    @Aggregation(pipeline \u003d {\n            \"{ \u0027$match\u0027: { \u0027createdAt\u0027: { \u0027$gte\u0027: ?0 } } }\",\n            \"{ \u0027$group\u0027: { \u0027_id\u0027: null, \u0027total\u0027: { \u0027$sum\u0027: \u0027$consumedGas\u0027 } } }\"\n    })\n    Double sumValueByCreatedAtAfter(LocalDateTime date);\n\n    @Aggregation(pipeline \u003d {\n            \"{ \u0027$match\u0027: { \u0027createdAt\u0027: { \u0027$gte\u0027: ?0 } } }\",\n            \"{ \u0027$project\u0027: { \" +\n                    \"    \u0027date\u0027: { \u0027$dateToString\u0027: { \u0027format\u0027: \u0027%Y-%m-%d\u0027, \u0027date\u0027: \u0027$createdAt\u0027 } }, \" +\n                    \"    \u0027consumedGas\u0027: 1 \" +\n                    \"} }\",\n            \"{ \u0027$group\u0027: { \" +\n                    \"    \u0027_id\u0027: \u0027$date\u0027, \" +\n                    \"    \u0027total\u0027: { \u0027$sum\u0027: \u0027$consumedGas\u0027 } \" +\n                    \"} }\",\n            \"{ \u0027$project\u0027: { \" +\n                    \"    \u0027_id\u0027: 0, \" +\n                    \"    \u0027date\u0027: \u0027$_id\u0027, \" +\n                    \"    \u0027total\u0027: 1 \" +\n                    \"} }\",\n            \"{ \u0027$sort\u0027: { \u0027date\u0027: 1 } }\"\n    })\n    List\u003cDailyStat\u003e getLast7DaysStats(LocalDateTime startDate);",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 35
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/repository/VehicleLogRepository.java",
      "timestamp": 1765918399623,
      "startOffset": 96,
      "endOffset": 1111,
      "codeContent": "ai.DailyStat;\nimport com.greentechinnovators.backend.entity.VehicleLog;\nimport org.springframework.data.mongodb.repository.Aggregation;\nimport org.springframework.data.mongodb.repository.MongoRepository;\nimport org.springframework.stereotype.Repository;\n\nimport java.time.LocalDateTime;\nimport java.util.List;\n\n@Repository\npublic interface VehicleLogRepository extends MongoRepository\u003cVehicleLog,String\u003e {\n\n    @Aggregation(pipeline \u003d {\n            \"{ \u0027$match\u0027: { \u0027createdAt\u0027: { \u0027$gte\u0027: ?0 } } }\",\n            \"{ \u0027$group\u0027: { \u0027_id\u0027: null, \u0027total\u0027: { \u0027$sum\u0027: \u0027$distanceTravelled\u0027 } } }\"\n    })\n    Double sumDistanceByCreatedAtAfter(LocalDateTime date);\n\n    @Aggregation(pipeline \u003d {\n            \"{ \u0027$match\u0027: { \u0027createdAt\u0027: { \u0027$gte\u0027: ?0 } } }\",\n            \"{ \u0027$group\u0027: { \u0027_id\u0027: { $dateToString: { format: \u0027%Y-%m-%d\u0027, date: \u0027$createdAt\u0027 } }, \u0027total\u0027: { \u0027$sum\u0027: \u0027$distanceTravelled\u0027 } } }\", // \u003c-- distance\n            \"{ \u0027$sort\u0027: { \u0027_id\u0027: 1 } }\"\n    })\n    List\u003cDailyStat\u003e getLast7DaysStats(LocalDateTime startDate);",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 24
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/repository/EnergyRepository.java",
      "timestamp": 1765918399616,
      "startOffset": 96,
      "endOffset": 1558,
      "codeContent": "ai.DailyStat;\nimport com.greentechinnovators.backend.entity.Energy;\nimport org.springframework.data.mongodb.repository.Aggregation;\nimport org.springframework.data.mongodb.repository.MongoRepository;\nimport org.springframework.stereotype.Repository;\n\nimport java.time.LocalDateTime;\nimport java.util.List;\n\n@Repository\npublic interface EnergyRepository extends MongoRepository\u003cEnergy, String\u003e {\n    List\u003cEnergy\u003e findAllByOrderByCreatedAtDesc();\n\n    @Aggregation(pipeline \u003d {\n            \"{ \u0027$match\u0027: { \u0027createdAt\u0027: { \u0027$gte\u0027: ?0 } } }\",\n            \"{ \u0027$group\u0027: { \u0027_id\u0027: null, \u0027total\u0027: { \u0027$sum\u0027: \u0027$energyConsumed\u0027 } } }\"\n    })\n    Double sumValueByCreatedAtAfter(LocalDateTime date);\n\n    @Aggregation(pipeline \u003d {\n            \"{ \u0027$match\u0027: { \u0027createdAt\u0027: { \u0027$gte\u0027: ?0 } } }\",\n\n            \"{ \u0027$project\u0027: { \" +\n                    \"    \u0027date\u0027: { \u0027$dateToString\u0027: { \u0027format\u0027: \u0027%Y-%m-%d\u0027, \u0027date\u0027: \u0027$createdAt\u0027 } }, \" +\n                    \"    \u0027energyConsumed\u0027: 1 \" +\n                    \"} }\",\n\n            \"{ \u0027$group\u0027: { \" +\n                    \"    \u0027_id\u0027: \u0027$date\u0027, \" +\n                    \"    \u0027total\u0027: { \u0027$sum\u0027: \u0027$energyConsumed\u0027 } \" +\n                    \"} }\",\n\n            \"{ \u0027$project\u0027: { \" +\n                    \"    \u0027_id\u0027: 0, \" +\n                    \"    \u0027date\u0027: \u0027$_id\u0027, \" +\n                    \"    \u0027total\u0027: 1 \" +\n                    \"} }\",\n\n            \"{ \u0027$sort\u0027: { \u0027date\u0027: 1 } }\"\n    })\n    List\u003cDailyStat\u003e getLast7DaysStats(LocalDateTime startDate);",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 41
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/repository/TrashRepository.java",
      "timestamp": 1765918399605,
      "startOffset": 96,
      "endOffset": 1528,
      "codeContent": "ai.DailyStat;\nimport com.greentechinnovators.backend.entity.Trash;\nimport org.springframework.data.mongodb.repository.Aggregation;\nimport org.springframework.data.mongodb.repository.MongoRepository;\nimport org.springframework.stereotype.Repository;\n\nimport java.time.LocalDateTime;\nimport java.util.List;\n\n@Repository\npublic interface TrashRepository extends MongoRepository\u003cTrash, String\u003e {\n    List\u003cTrash\u003e findAllByOrderByCreatedAtDesc();\n\n    @Aggregation(pipeline \u003d {\n            \"{ \u0027$match\u0027: { \u0027createdAt\u0027: { \u0027$gte\u0027: ?0 } } }\",\n            \"{ \u0027$group\u0027: { \u0027_id\u0027: null, \u0027total\u0027: { \u0027$sum\u0027: \u0027$weight\u0027 } } }\"\n    })\n    Double sumWeightByCreatedAtAfter(LocalDateTime date);\n\n    @Aggregation(pipeline \u003d {\n            \"{ \u0027$match\u0027: { \u0027createdAt\u0027: { \u0027$gte\u0027: ?0 } } }\",\n            \"{ \u0027$project\u0027: { \" +\n                    \"    \u0027date\u0027: { \u0027$dateToString\u0027: { \u0027format\u0027: \u0027%Y-%m-%d\u0027, \u0027date\u0027: \u0027$createdAt\u0027 } }, \" +\n                    \"    \u0027wight\u0027: 1 \" +\n                    \"} }\",\n\n            \"{ \u0027$group\u0027: { \" +\n                    \"    \u0027_id\u0027: \u0027$date\u0027, \" +\n                    \"    \u0027total\u0027: { \u0027$sum\u0027: \u0027$wight\u0027 } \" +\n                    \"} }\",\n\n            \"{ \u0027$project\u0027: { \" +\n                    \"    \u0027_id\u0027: 0, \" +\n                    \"    \u0027date\u0027: \u0027$_id\u0027, \" +\n                    \"    \u0027total\u0027: 1 \" +\n                    \"} }\",\n\n            \"{ \u0027$sort\u0027: { \u0027date\u0027: 1 } }\"\n    })\n    List\u003cDailyStat\u003e getLast7DaysStats(LocalDateTime startDate);",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 40
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/PredictionService.java",
      "timestamp": 1765918414277,
      "startOffset": 141,
      "endOffset": 7686,
      "codeContent": "controller.DashboardController;\nimport com.greentechinnovators.backend.dto.DailyStatProjection;\n\nimport com.greentechinnovators.backend.dto.Energy.Responce.DailyEnergyDTO;\nimport com.greentechinnovators.backend.dto.ai.PredictionResponse;\nimport com.greentechinnovators.backend.dto.gas.responce.DailyGasDTO;\nimport com.greentechinnovators.backend.dto.trash.response.DailyTrashDTO;\nimport com.greentechinnovators.backend.repository.EnergyRepository;\nimport com.greentechinnovators.backend.repository.GasRepository;\nimport com.greentechinnovators.backend.repository.TrashRepository;\nimport com.greentechinnovators.backend.repository.VehicleLogRepository;\nimport com.greentechinnovators.backend.service.ai.AiContextManager;\nimport com.greentechinnovators.backend.service.ai.DeepSeekClient;\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\n\nimport org.springframework.stereotype.Service;\nimport org.springframework.web.client.RestTemplate;\n\nimport java.time.LocalDateTime;\nimport java.util.ArrayList;\nimport java.util.HashMap;\nimport java.util.List;\nimport java.util.Map;\n\n@Slf4j\n@Service\n@RequiredArgsConstructor\npublic class PredictionService {\n\n    private final EnergyRepository energyRepository;\n    private final GasRepository gasRepository;\n    private final TrashRepository trashRepository;\n    private final VehicleLogRepository vehicleLogRepository;\n\n    private final AiContextManager aiContextManager;\n    private final RestTemplate restTemplate;\n    private final ObjectMapper objectMapper;\n\n    private final DeepSeekClient callDeepSeek;\n    private final DashboardController dashboardController;\n\n    private static final double PRIX_ELEC \u003d 1.20;       // MAD/kWh\n    private static final double PRIX_GAZ \u003d 12.50;       // MAD/kg\n    private static final double PRIX_TRANSPORT \u003d 14.00; // MAD/100km\n    private static final double PRIX_DECHETS \u003d 0.80;    // MAD/kg\n\n    public PredictionResponse generatePredictions() {\n        String contextJson \u003d aiContextManager.getGlobalContextJson();\n\n        // 2. Prompt Dynamique (Incorpore les Prix et le Contexte)\n        String prompt \u003d \"\"\"\n                    R√îLE : Expert en Audit √ânerg√©tique Industriel \u0026 Pr√©vision IA.\n                    T√ÇCHE : Pr√©dire la consommation et les co√ªts du MOIS PROCHAIN (N+1).\n                \n                    PARAM√àTRES DE CO√õT (Utilise ces valeurs pour calculer \u0027coutPrevu\u0027) :\n                    - √âlectricit√© : %.2f MAD / kWh\n                    - Gaz (LPG)   : %.2f MAD / kg\n                    - Transport   : %.2f MAD / 100 km\n                    - D√©chets     : %.2f MAD / kg\n                \n                    DONN√âES D\u0027ENTR√âE (Mois en cours vs Mois Pr√©c√©dent) :\n                    %s\n                \n                    R√àGLES STRICTES :\n                    1. R√©ponds UNIQUEMENT avec un JSON valide.\n                    2. PAS de Markdown, PAS d\u0027intro/outro.\n                    3. Pour \u0027pourcentage\u0027, utilise le format \"+X%%\" ou \"-X%%\".\n                    4. Si une donn√©e historique manque pour le pourcentage, mets \"N/A\".\n                \n                    FORMAT JSON ATTENDU :\n                    {\n                        \"electricite\": { \"valeurPrincipale\": \"X kWh\", \"pourcentage\": \"+X%%\", \"coutPrevu\": \"X MAD\", \"emissionCo2\": \"X kg CO2\" },\n                        \"gaz\": { \"valeurPrincipale\": \"X kg\", \"pourcentage\": \"+X%%\", \"coutPrevu\": \"X MAD\", \"emissionCo2\": \"X kg CO2\" },\n                        \"transport\": { \"valeurPrincipale\": \"X km\", \"pourcentage\": \"+X%%\", \"coutPrevu\": \"X MAD\", \"emissionCo2\": \"X kg CO2\" },\n                        \"dechets\": { \"valeurPrincipale\": \"X kg\", \"pourcentage\": \"+X%%\", \"coutPrevu\": \"X MAD\", \"emissionCo2\": \"X kg CO2\" }\n                    }\n                \"\"\".formatted(PRIX_ELEC, PRIX_GAZ, PRIX_TRANSPORT, PRIX_DECHETS, contextJson);\n\n        String rawJson \u003d callDeepSeek.generate(prompt);\n        String cleanJson \u003d rawJson.replace(\"```json\", \"\").replace(\"```\", \"\").trim();\n\n        PredictionResponse response;\n        try {\n            response \u003d objectMapper.readValue(cleanJson, PredictionResponse.class);\n        } catch (Exception e) {\n            log.error(\"Erreur parsing Prediction\", e);\n            response \u003d new PredictionResponse();\n        }\n\n        LocalDateTime sevenDaysAgo \u003d LocalDateTime.now().minusDays(6).withHour(0).withMinute(0).withSecond(0).withNano(0);\n\n        if (response.getElectricite() \u003d\u003d null) response.setElectricite(new PredictionResponse.CategoryPrediction());\n        response.getElectricite().setHistory(getEnergyHistoryData(dashboardController.getEnergyHistory(7)));\n\n        if (response.getGaz() \u003d\u003d null) response.setGaz(new PredictionResponse.CategoryPrediction());\n        response.getGaz().setHistory(getGasHistoryData(dashboardController.getGasHistory(7)));\n\n//        if (response.getTransport() \u003d\u003d null) response.setTransport(new PredictionResponse.CategoryPrediction());\n//        response.getTransport().setHistory(getHistoryData(dashboardController.gett(sevenDaysAgo)));\n\n        if (response.getDechets() \u003d\u003d null) response.setDechets(new PredictionResponse.CategoryPrediction());\n        response.getDechets().setHistory(getTrashHistoryData(dashboardController.getTrashHistory(7)));\n\n        return response;\n    }\n\n\n\n    private List\u003cDouble\u003e getEnergyHistoryData(List\u003ccom.greentechinnovators.backend.dto.Energy.Responce.DailyEnergyDTO\u003e dbStats) {\n        Map\u003cString, Double\u003e statsMap \u003d new HashMap\u003c\u003e();\n\n        if (dbStats !\u003d null) {\n            for (DailyEnergyDTO stat : dbStats) {\n                statsMap.put(stat.getDate().toLocalDate().toString(), stat.getTotalEnergyKwh());\n            }\n        }\n\n        List\u003cDouble\u003e history \u003d new ArrayList\u003c\u003e();\n        LocalDateTime dateIter \u003d LocalDateTime.now().minusDays(6).withHour(0).withMinute(0).withSecond(0).withNano(0);\n\n        for (int i \u003d 0; i \u003c 7; i++) {\n            String key \u003d dateIter.toLocalDate().toString();\n            history.add(statsMap.getOrDefault(key, 0.0));\n            dateIter \u003d dateIter.plusDays(1);\n        }\n        return history;\n    }\n\n    private List\u003cDouble\u003e getTrashHistoryData(List\u003cDailyTrashDTO\u003e dbStats) {\n        Map\u003cString, Double\u003e statsMap \u003d new HashMap\u003c\u003e();\n\n        if (dbStats !\u003d null) {\n            for (DailyTrashDTO stat : dbStats) {\n                statsMap.put(stat.getDate().toLocalDate().toString(), stat.getTotalWeightKg());\n            }\n        }\n\n        List\u003cDouble\u003e history \u003d new ArrayList\u003c\u003e();\n        LocalDateTime dateIter \u003d LocalDateTime.now().minusDays(6).withHour(0).withMinute(0).withSecond(0).withNano(0);\n\n        for (int i \u003d 0; i \u003c 7; i++) {\n            String key \u003d dateIter.toLocalDate().toString();\n            history.add(statsMap.getOrDefault(key, 0.0));\n            dateIter \u003d dateIter.plusDays(1);\n        }\n        return history;\n    }\n\n    private List\u003cDouble\u003e getGasHistoryData(List\u003cDailyGasDTO\u003e dbStats) {\n        Map\u003cString, Double\u003e statsMap \u003d new HashMap\u003c\u003e();\n\n        if (dbStats !\u003d null) {\n            for (DailyGasDTO stat : dbStats) {\n                statsMap.put(stat.getDate().toLocalDate().toString(), stat.getCarbonFootprintKg());\n            }\n        }\n\n        List\u003cDouble\u003e history \u003d new ArrayList\u003c\u003e();\n        LocalDateTime dateIter \u003d LocalDateTime.now().minusDays(6).withHour(0).withMinute(0).withSecond(0).withNano(0);\n\n        for (int i \u003d 0; i \u003c 7; i++) {\n            String key \u003d dateIter.toLocalDate().toString();\n            history.add(statsMap.getOrDefault(key, 0.0));\n            dateIter \u003d dateIter.plusDays(1);\n        }\n        return history;\n    }\n\n",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 170
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/controller/AlertController.java",
      "timestamp": 1765918623117,
      "startOffset": 100,
      "endOffset": 594,
      "codeContent": "SmsService;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.web.bind.annotation.*;\n\n@RestController\n@RequestMapping(\"/api/alert\")\n@RequiredArgsConstructor\npublic class AlertController {\n\n    private final SmsService smsService;\n\n\n    @PostMapping\n    public String sendAlert(@RequestParam double co2) {\n        if (co2 \u003e 1000) {\n            smsService.sendSms(\"+212659763229\", \"‚ö†Ô∏è CO2 √©lev√© d√©tect√© !\");\n        }\n        return \"Check completed, SMS sent if needed\";\n    }\n}\n",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 21
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/mapper/UserMapper.java",
      "timestamp": 1765918647955,
      "startOffset": 92,
      "endOffset": 871,
      "codeContent": "UserResponseDTO;\nimport com.greentechinnovators.backend.dto.auth.RegisterRequest;\nimport com.greentechinnovators.backend.entity.User;\nimport org.springframework.stereotype.Component;\n\n@Component\npublic class UserMapper {\n    public User toEntity(RegisterRequest dto){\n        return User.builder()\n                .name(dto.getName())\n                .email(dto.getEmail())\n                .role(dto.getRole())\n                .department(dto.getDepartment())\n                .build();\n    }\n\n    public static UserResponseDTO toUserDTO(User user) {\n        if (user \u003d\u003d null) return null;\n\n        return UserResponseDTO.builder()\n                .id(user.getId())\n                .username(user.getName())\n                .email(user.getEmail())\n                .build();\n    }\n",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 26
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/UserService.java",
      "timestamp": 1765918647966,
      "startOffset": 303,
      "endOffset": 3368,
      "codeContent": "Department;\nimport com.greentechinnovators.backend.entity.User;\nimport com.greentechinnovators.backend.gamification.domain.UserGamificationStats;\nimport com.greentechinnovators.backend.gamification.repository.GamificationStatsRepository;\nimport com.greentechinnovators.backend.repository.DepartmentRepository;\nimport com.greentechinnovators.backend.repository.UserRepository;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.security.crypto.password.PasswordEncoder;\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\n\nimport java.time.LocalDateTime;\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.stream.Collectors;\n\n@Service\n@RequiredArgsConstructor\npublic class UserService {\n\n    private final UserRepository userRepository;\n    private final GamificationStatsRepository gamificationStatsRepository;\n    private final PasswordEncoder passwordEncoder;\n    private final EmailService emailService;\n    private final DepartmentRepository departmentRepository;\n    public List\u003cUserProfileDTO\u003e getAllUsers() {\n        return userRepository.findAll().stream()\n                .map(this::mapToProfileDTO)\n                .collect(Collectors.toList());\n    }\n\n    @Transactional\n    public UserProfileDTO createUser(CreateUserRequestDTO request) {\n        if (userRepository.findByEmail(request.getEmail()).isPresent()) {\n            throw new RuntimeException(\"Email is already in use\");\n        }\n\n        int randompassword \u003d 100 + (int)(Math.random() * 1000);\n        String password \u003d \"GreenTech\"+ randompassword ;\n        String generatedPassword \u003d passwordEncoder.encode(password);\n\n        User user \u003d User.builder()\n                .name(request.getName())\n                .email(request.getEmail())\n                .passwordHash(generatedPassword)\n                .role(request.getRole())\n                .department(request.getDepartment())\n                .jobTitle(request.getJobTitle())\n                .createdAt(LocalDateTime.now())\n                .updatedAt(LocalDateTime.now())\n                .build();\n\n\n        User savedUser \u003d userRepository.save(user);\n\n        if (request.getDepartment() !\u003d null \u0026\u0026 !request.getDepartment().isEmpty()) {\n\n            Department dept \u003d departmentRepository.findByName(request.getDepartment())\n                    .orElseGet(() -\u003e {\n                        Department newDept \u003d Department.builder()\n                                .name(request.getDepartment())\n                                .users(new ArrayList\u003c\u003e())\n                                .build();\n                        return departmentRepository.save(newDept);\n                    });\n\n            if (dept.getUsers() \u003d\u003d null) {\n                dept.setUsers(new ArrayList\u003c\u003e());\n            }\n            dept.getUsers().add(savedUser);\n\n            departmentRepository.save(dept);\n        }\n        emailService.sendAccountCreatedEmail(\n                request.getEmail(),\n                request.getName(),\n                password\n        );",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 78
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/DepartmentService.java",
      "timestamp": 1765918647970,
      "startOffset": 93,
      "endOffset": 2058,
      "codeContent": "UserResponseDTO;\nimport com.greentechinnovators.backend.dto.department.DepartmentRequestDTO;\nimport com.greentechinnovators.backend.dto.department.DepartmentResponseDTO;\nimport com.greentechinnovators.backend.entity.Department;\nimport com.greentechinnovators.backend.entity.User;\nimport com.greentechinnovators.backend.mapper.DepartmentMapper;\nimport com.greentechinnovators.backend.mapper.UserMapper;\nimport com.greentechinnovators.backend.repository.DepartmentRepository;\nimport com.greentechinnovators.backend.repository.UserRepository;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.stereotype.Service;\nimport org.springframework.web.client.ResourceAccessException;\n\nimport java.util.List;\nimport java.util.stream.Collectors;\n\n@Service\n@RequiredArgsConstructor\npublic class DepartmentService {\n\n    private final DepartmentRepository departmentRepository;\n    private final DepartmentMapper departmentMapper;\n    private final UserRepository userRepository;\n    // --- CREATE ---\n    public DepartmentResponseDTO createDepartment(DepartmentRequestDTO requestDTO) {\n        Department department \u003d departmentMapper.toEntity(requestDTO);\n        Department savedDepartment \u003d departmentRepository.save(department);\n        return departmentMapper.toDTO(savedDepartment);\n    }\n\n    // --- READ (All) ---\n    public List\u003cDepartmentResponseDTO\u003e getAllDepartments() {\n        List\u003cDepartment\u003e departments \u003d departmentRepository.findAll();\n\n        return departments.stream().map(dept -\u003e {\n            List\u003cUser\u003e realUsers \u003d userRepository.findByDepartment(dept.getName());\n\n            List\u003cUserResponseDTO\u003e userDTOs \u003d realUsers.stream()\n                    .map(UserMapper::toUserDTO)\n                    .collect(Collectors.toList());\n\n            return DepartmentResponseDTO.builder()\n                    .id(dept.getId())\n                    .name(dept.getName())\n                    .users(userDTOs)\n                    .build();\n\n        })",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 48
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/repository/UserRepository.java",
      "timestamp": 1765918647988,
      "startOffset": 241,
      "endOffset": 500,
      "codeContent": "List;\nimport java.util.Optional;\n\n@Repository\npublic interface UserRepository extends MongoRepository\u003cUser , String\u003e {\n\n    Optional\u003cUser\u003e findByEmail(String email);\n\n    boolean existsByEmail(String login);\n    List\u003cUser\u003e findByDepartment(String department);",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 10
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/repository/DepartmentRepository.java",
      "timestamp": 1765918648005,
      "startOffset": 230,
      "endOffset": 494,
      "codeContent": "import java.util.Optional;\n\n@Repository\npublic interface DepartmentRepository extends MongoRepository\u003cDepartment, String\u003e {\n    // You can add custom queries here if needed, e.g., boolean existsByName(String name);\n    Optional\u003cDepartment\u003e findByName(String name);",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 6
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/controller/AiController.java",
      "timestamp": 1765918648101,
      "startOffset": 96,
      "endOffset": 2328,
      "codeContent": "ai.AiAlertDTO;\nimport com.greentechinnovators.backend.dto.ai.PredictionResponse;\nimport com.greentechinnovators.backend.dto.ai.RecommendationResponse;\nimport com.greentechinnovators.backend.service.AiAlertService;\nimport com.greentechinnovators.backend.service.ChatService;\nimport com.greentechinnovators.backend.service.PredictionService;\nimport com.greentechinnovators.backend.service.RecommendationService;\nimport org.springframework.http.MediaType;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.bind.annotation.*;\nimport reactor.core.publisher.Flux;\n\nimport java.util.List;\nimport java.util.Map;\n\n@RestController\n@RequestMapping(\"/api/ai\")\npublic class AiController {\n\n    private final ChatService aiService;\n    private final PredictionService generatePredictions;\n    private final RecommendationService recommendationService;\n    private final AiAlertService aiAlertService;\n\n    public AiController(ChatService aiService, PredictionService generatePredictions, RecommendationService recommendationService, AiAlertService aiAlertService) {\n        this.aiService \u003d aiService;\n        this.generatePredictions \u003d generatePredictions;\n        this.recommendationService \u003d recommendationService;\n        this.aiAlertService \u003d aiAlertService;\n    }\n\n\n    @PostMapping(value \u003d \"/chat/stream\", produces \u003d MediaType.TEXT_EVENT_STREAM_VALUE)\n    public Flux\u003cString\u003e chatStream(@RequestBody Map\u003cString, Object\u003e payload) {\n        String userMessage \u003d (String) payload.get(\"message\");\n        List\u003cMap\u003cString, String\u003e\u003e history \u003d (List\u003cMap\u003cString, String\u003e\u003e) payload.get(\"history\");\n\n        return aiService.askAIStream(userMessage, history);\n    }\n\n    @GetMapping(\"/predictions\")\n    public PredictionResponse getPredictions() {\n        return generatePredictions.generatePredictions();\n    }\n\n    @GetMapping(\"/recommendations\")\n    public ResponseEntity\u003cRecommendationResponse\u003e getRecommendations() {\n        return ResponseEntity.ok(recommendationService.generateRecommendations());\n    }\n\n\n    @GetMapping(\"/alerts\")\n    public ResponseEntity\u003cList\u003cAiAlertDTO\u003e\u003e getAiGeneratedAlerts() {\n        List\u003cAiAlertDTO\u003e alerts \u003d aiAlertService.generateSmartAlerts();\n        return ResponseEntity.ok(alerts",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 55
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/dto/auth/AuthResponse.java",
      "timestamp": 1765977761870,
      "startOffset": 231,
      "endOffset": 256,
      "codeContent": "name;\n    private String ",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 2
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/PredictionService.java",
      "timestamp": 1765977819870,
      "startOffset": 141,
      "endOffset": 7622,
      "codeContent": "controller.DashboardController;\n\nimport com.greentechinnovators.backend.dto.Energy.Responce.DailyEnergyDTO;\nimport com.greentechinnovators.backend.dto.ai.PredictionResponse;\nimport com.greentechinnovators.backend.dto.gas.responce.DailyGasDTO;\nimport com.greentechinnovators.backend.dto.trash.response.DailyTrashDTO;\nimport com.greentechinnovators.backend.repository.EnergyRepository;\nimport com.greentechinnovators.backend.repository.GasRepository;\nimport com.greentechinnovators.backend.repository.TrashRepository;\nimport com.greentechinnovators.backend.repository.VehicleLogRepository;\nimport com.greentechinnovators.backend.service.ai.AiContextManager;\nimport com.greentechinnovators.backend.service.ai.DeepSeekClient;\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\n\nimport org.springframework.stereotype.Service;\nimport org.springframework.web.client.RestTemplate;\n\nimport java.time.LocalDateTime;\nimport java.util.ArrayList;\nimport java.util.HashMap;\nimport java.util.List;\nimport java.util.Map;\n\n@Slf4j\n@Service\n@RequiredArgsConstructor\npublic class PredictionService {\n\n    private final EnergyRepository energyRepository;\n    private final GasRepository gasRepository;\n    private final TrashRepository trashRepository;\n    private final VehicleLogRepository vehicleLogRepository;\n\n    private final AiContextManager aiContextManager;\n    private final RestTemplate restTemplate;\n    private final ObjectMapper objectMapper;\n\n    private final DeepSeekClient callDeepSeek;\n    private final DashboardController dashboardController;\n\n    private static final double PRIX_ELEC \u003d 1.20;       // MAD/kWh\n    private static final double PRIX_GAZ \u003d 12.50;       // MAD/kg\n    private static final double PRIX_TRANSPORT \u003d 14.00; // MAD/100km\n    private static final double PRIX_DECHETS \u003d 0.80;    // MAD/kg\n\n    public PredictionResponse generatePredictions() {\n        String contextJson \u003d aiContextManager.getGlobalContextJson();\n\n        // 2. Prompt Dynamique (Incorpore les Prix et le Contexte)\n        String prompt \u003d \"\"\"\n                    R√îLE : Expert en Audit √ânerg√©tique Industriel \u0026 Pr√©vision IA.\n                    T√ÇCHE : Pr√©dire la consommation et les co√ªts du MOIS PROCHAIN (N+1).\n                \n                    PARAM√àTRES DE CO√õT (Utilise ces valeurs pour calculer \u0027coutPrevu\u0027) :\n                    - √âlectricit√© : %.2f MAD / kWh\n                    - Gaz (LPG)   : %.2f MAD / kg\n                    - Transport   : %.2f MAD / 100 km\n                    - D√©chets     : %.2f MAD / kg\n                \n                    DONN√âES D\u0027ENTR√âE (Mois en cours vs Mois Pr√©c√©dent) :\n                    %s\n                \n                    R√àGLES STRICTES :\n                    1. R√©ponds UNIQUEMENT avec un JSON valide.\n                    2. PAS de Markdown, PAS d\u0027intro/outro.\n                    3. Pour \u0027pourcentage\u0027, utilise le format \"+X%%\" ou \"-X%%\".\n                    4. Si une donn√©e historique manque pour le pourcentage, mets \"N/A\".\n                \n                    FORMAT JSON ATTENDU :\n                    {\n                        \"electricite\": { \"valeurPrincipale\": \"X kWh\", \"pourcentage\": \"+X%%\", \"coutPrevu\": \"X MAD\", \"emissionCo2\": \"X kg CO2\" },\n                        \"gaz\": { \"valeurPrincipale\": \"X kg\", \"pourcentage\": \"+X%%\", \"coutPrevu\": \"X MAD\", \"emissionCo2\": \"X kg CO2\" },\n                        \"transport\": { \"valeurPrincipale\": \"X km\", \"pourcentage\": \"+X%%\", \"coutPrevu\": \"X MAD\", \"emissionCo2\": \"X kg CO2\" },\n                        \"dechets\": { \"valeurPrincipale\": \"X kg\", \"pourcentage\": \"+X%%\", \"coutPrevu\": \"X MAD\", \"emissionCo2\": \"X kg CO2\" }\n                    }\n                \"\"\".formatted(PRIX_ELEC, PRIX_GAZ, PRIX_TRANSPORT, PRIX_DECHETS, contextJson);\n\n        String rawJson \u003d callDeepSeek.generate(prompt);\n        String cleanJson \u003d rawJson.replace(\"```json\", \"\").replace(\"```\", \"\").trim();\n\n        PredictionResponse response;\n        try {\n            response \u003d objectMapper.readValue(cleanJson, PredictionResponse.class);\n        } catch (Exception e) {\n            log.error(\"Erreur parsing Prediction\", e);\n            response \u003d new PredictionResponse();\n        }\n\n        LocalDateTime sevenDaysAgo \u003d LocalDateTime.now().minusDays(6).withHour(0).withMinute(0).withSecond(0).withNano(0);\n\n        if (response.getElectricite() \u003d\u003d null) response.setElectricite(new PredictionResponse.CategoryPrediction());\n        response.getElectricite().setHistory(getEnergyHistoryData(dashboardController.getEnergyHistory(7)));\n\n        if (response.getGaz() \u003d\u003d null) response.setGaz(new PredictionResponse.CategoryPrediction());\n        response.getGaz().setHistory(getGasHistoryData(dashboardController.getGasHistory(7)));\n\n//        if (response.getTransport() \u003d\u003d null) response.setTransport(new PredictionResponse.CategoryPrediction());\n//        response.getTransport().setHistory(getHistoryData(dashboardController.gett(sevenDaysAgo)));\n\n        if (response.getDechets() \u003d\u003d null) response.setDechets(new PredictionResponse.CategoryPrediction());\n        response.getDechets().setHistory(getTrashHistoryData(dashboardController.getTrashHistory(7)));\n\n        return response;\n    }\n\n\n\n    private List\u003cDouble\u003e getEnergyHistoryData(List\u003ccom.greentechinnovators.backend.dto.Energy.Responce.DailyEnergyDTO\u003e dbStats) {\n        Map\u003cString, Double\u003e statsMap \u003d new HashMap\u003c\u003e();\n\n        if (dbStats !\u003d null) {\n            for (DailyEnergyDTO stat : dbStats) {\n                statsMap.put(stat.getDate().toLocalDate().toString(), stat.getTotalEnergyKwh());\n            }\n        }\n\n        List\u003cDouble\u003e history \u003d new ArrayList\u003c\u003e();\n        LocalDateTime dateIter \u003d LocalDateTime.now().minusDays(6).withHour(0).withMinute(0).withSecond(0).withNano(0);\n\n        for (int i \u003d 0; i \u003c 7; i++) {\n            String key \u003d dateIter.toLocalDate().toString();\n            history.add(statsMap.getOrDefault(key, 0.0));\n            dateIter \u003d dateIter.plusDays(1);\n        }\n        return history;\n    }\n\n    private List\u003cDouble\u003e getTrashHistoryData(List\u003cDailyTrashDTO\u003e dbStats) {\n        Map\u003cString, Double\u003e statsMap \u003d new HashMap\u003c\u003e();\n\n        if (dbStats !\u003d null) {\n            for (DailyTrashDTO stat : dbStats) {\n                statsMap.put(stat.getDate().toLocalDate().toString(), stat.getTotalWeightKg());\n            }\n        }\n\n        List\u003cDouble\u003e history \u003d new ArrayList\u003c\u003e();\n        LocalDateTime dateIter \u003d LocalDateTime.now().minusDays(6).withHour(0).withMinute(0).withSecond(0).withNano(0);\n\n        for (int i \u003d 0; i \u003c 7; i++) {\n            String key \u003d dateIter.toLocalDate().toString();\n            history.add(statsMap.getOrDefault(key, 0.0));\n            dateIter \u003d dateIter.plusDays(1);\n        }\n        return history;\n    }\n\n    private List\u003cDouble\u003e getGasHistoryData(List\u003cDailyGasDTO\u003e dbStats) {\n        Map\u003cString, Double\u003e statsMap \u003d new HashMap\u003c\u003e();\n\n        if (dbStats !\u003d null) {\n            for (DailyGasDTO stat : dbStats) {\n                statsMap.put(stat.getDate().toLocalDate().toString(), stat.getCarbonFootprintKg());\n            }\n        }\n\n        List\u003cDouble\u003e history \u003d new ArrayList\u003c\u003e();\n        LocalDateTime dateIter \u003d LocalDateTime.now().minusDays(6).withHour(0).withMinute(0).withSecond(0).withNano(0);\n\n        for (int i \u003d 0; i \u003c 7; i++) {\n            String key \u003d dateIter.toLocalDate().toString();\n            history.add(statsMap.getOrDefault(key, 0.0));\n            dateIter \u003d dateIter.plusDays(1);\n        }\n        return history;\n    }\n\n",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 169
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/UserService.java",
      "timestamp": 1765982979731,
      "startOffset": 3787,
      "endOffset": 4377,
      "codeContent": "@Transactional\npublic void updatePassword(String userId, String oldPassword, String newPassword) {\n    User user \u003d userRepository.findById(userId)\n            .orElseThrow(() -\u003e new RuntimeException(\"User not found\"));\n\n    // 1. ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑŸÇÿØŸäŸÖÿ©\n    if (!passwordEncoder.matches(oldPassword, user.getPasswordHash())) {\n        throw new RuntimeException(\"Old password is incorrect\");\n    }\n\n    // 2. ÿ™ÿ¥ŸÅŸäÿ± Ÿàÿ≠ŸÅÿ∏ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ©\n    user.setPasswordHash(passwordEncoder.encode(newPassword));\n    user.setUpdatedAt(LocalDateTime.now());\n    \n    userRepository.save(user);\n}",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 16
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/controller/UserController.java",
      "timestamp": 1765983045967,
      "startOffset": 3079,
      "endOffset": 3568,
      "codeContent": "@PutMapping(\"/{userId}/password\")\n    public ResponseEntity\u003c?\u003e updatePassword(\n            @PathVariable String userId,\n            @RequestBody Map\u003cString, String\u003e passwords) {\n        \n        String oldPassword \u003d passwords.get(\"oldPassword\");\n        String newPassword \u003d passwords.get(\"newPassword\");\n\n        userService.updatePassword(userId, oldPassword, newPassword);\n        \n        return ResponseEntity.ok().body(Map.of(\"message\", \"Mot de passe mis √† jour avec succ√®s\"));\n    }",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 12
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/controller/UserController.java",
      "timestamp": 1765983050186,
      "startOffset": 3079,
      "endOffset": 3568,
      "codeContent": "@PutMapping(\"/{userId}/password\")\n    public ResponseEntity\u003c?\u003e updatePassword(\n            @PathVariable String userId,\n            @RequestBody Map\u003cString, String\u003e passwords) {\n        \n        String oldPassword \u003d passwords.get(\"oldPassword\");\n        String newPassword \u003d passwords.get(\"newPassword\");\n\n        userService.updatePassword(userId, oldPassword, newPassword);\n        \n        return ResponseEntity.ok().body(Map.of(\"message\", \"Mot de passe mis √† jour avec succ√®s\"));\n    }",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 12
    },
    {
      "filePath": "/UserController.java",
      "timestamp": 1765983053861,
      "startOffset": 3231,
      "endOffset": 3251,
      "codeContent": "IntellijIdeaRulezzz;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/controller/UserController.java",
      "timestamp": 1765983059583,
      "startOffset": 635,
      "endOffset": 656,
      "codeContent": "import java.util.Map;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/dto/ai/PredictionResponse.java",
      "timestamp": 1765988838092,
      "startOffset": 554,
      "endOffset": 598,
      "codeContent": "private List\u003cDistributionItem\u003e distribution;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/dto/ai/PredictionResponse.java",
      "timestamp": 1765988851251,
      "startOffset": 598,
      "endOffset": 1158,
      "codeContent": "public static class DistributionItem {\n        private String label;\n        private String value;\n\n        // Constructeurs, Getters \u0026 Setters\n        public DistributionItem() {}\n        public DistributionItem(String label, String value) {\n            this.label \u003d label;\n            this.value \u003d value;\n        }\n        public String getLabel() { return label; }\n        public void setLabel(String label) { this.label \u003d label; }\n        public String getValue() { return value; }\n        public void setValue(String value) { this.value \u003d value; }\n    }\n}",
      "aiProbability": 70,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 16
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/PredictionService.java",
      "timestamp": 1765988905620,
      "startOffset": 2177,
      "endOffset": 4247,
      "codeContent": "// Dans PredictionService.java\n\nString prompt \u003d \"\"\"\n    R√îLE : Expert en Audit √ânerg√©tique Industriel \u0026 Pr√©vision IA.\n    T√ÇCHE : Pr√©dire la consommation, les co√ªts et la R√âPARTITION pour le MOIS PROCHAIN (N+1).\n\n    PARAM√àTRES DE CO√õT :\n    - √âlectricit√© : %.2f MAD / kWh\n    - Gaz (LPG)   : %.2f MAD / kg\n    - Transport   : %.2f MAD / 100 km\n    - D√©chets     : %.2f MAD / kg\n\n    DONN√âES D\u0027ENTR√âE :\n    %s\n\n    R√àGLES STRICTES :\n    1. R√©ponds UNIQUEMENT avec un JSON valide.\n    2. Pour \u0027pourcentage\u0027, utilise le format \"+X%%\" ou \"-X%%\".\n    3. Pour \u0027distribution\u0027, donne 2 ou 3 postes majeurs avec des Emojis dans le label.\n\n    FORMAT JSON ATTENDU :\n    {\n        \"electricite\": { \n            \"valeurPrincipale\": \"X kWh\", \n            \"pourcentage\": \"+X%%\", \n            \"coutPrevu\": \"X MAD\", \n            \"emissionCo2\": \"X kg CO2\",\n            \"distribution\": [\n                { \"label\": \"üè≠ Production\", \"value\": \"XX%\" },\n                { \"label\": \"üí° √âclairage\", \"value\": \"XX%\" }\n            ]\n        },\n        \"gaz\": { \n            \"valeurPrincipale\": \"X kg\", \n            \"pourcentage\": \"+X%%\", \n            \"coutPrevu\": \"X MAD\", \n            \"emissionCo2\": \"X kg CO2\",\n            \"distribution\": [\n                { \"label\": \"üî• Fours\", \"value\": \"XX%\" },\n                { \"label\": \"üöø Sanitaire\", \"value\": \"XX%\" }\n            ]\n        },\n        \"transport\": { \n            \"valeurPrincipale\": \"X km\", \n            \"pourcentage\": \"+X%%\", \n            \"coutPrevu\": \"X MAD\", \n            \"emissionCo2\": \"X kg CO2\",\n            \"distribution\": [\n                 { \"label\": \"üöõ Logistique\", \"value\": \"XX%\" },\n                 { \"label\": \"üöó Commercial\", \"value\": \"XX%\" }\n            ]\n        },\n        \"dechets\": { \n            \"valeurPrincipale\": \"X kg\", \n            \"pourcentage\": \"+X%%\", \n            \"coutPrevu\": \"X MAD\", \n            \"emissionCo2\": \"X kg CO2\",\n            \"distribution\": [\n                { \"label\": \"‚ôªÔ∏è Recyclable\", \"value\": \"XX%\" },\n                { \"label\": \"üóëÔ∏è Organique\", \"value\": \"XX%\" }\n            ]\n        }\n    }\n",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 64
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/ai/AiPromptStore.java",
      "timestamp": 1765989531903,
      "startOffset": 0,
      "endOffset": 84,
      "codeContent": "package com.greentechinnovators.backend.service.ai;\n\npublic class AiPromptStore {\n}\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/ai/AiPromptStore.java",
      "timestamp": 1765989536796,
      "startOffset": 53,
      "endOffset": 2920,
      "codeContent": "import org.springframework.stereotype.Component;\n\n@Component\npublic class AiPromptStore {\n\n    public String getPredictionPrompt(double prixElec, double prixGaz, double prixTransport, double prixDechets, String contextJson) {\n        // Hna 7atit l prompt m3zoul w mrigl (m3a %% fix)\n        return \"\"\"\n            R√îLE : Expert en Audit √ânerg√©tique Industriel \u0026 Pr√©vision IA.\n            T√ÇCHE : Pr√©dire la consommation, les co√ªts et la R√âPARTITION pour le MOIS PROCHAIN (N+1).\n\n            PARAM√àTRES DE CO√õT :\n            - √âlectricit√© : %.2f MAD / kWh\n            - Gaz (LPG)   : %.2f MAD / kg\n            - Transport   : %.2f MAD / 100 km\n            - D√©chets     : %.2f MAD / kg\n\n            DONN√âES D\u0027ENTR√âE :\n            %s\n\n            R√àGLES STRICTES :\n            1. R√©ponds UNIQUEMENT avec un JSON valide.\n            2. Pour \u0027pourcentage\u0027, utilise le format \"+X%%\" ou \"-X%%\".\n            3. Pour \u0027distribution\u0027, donne 2 ou 3 postes majeurs avec des Emojis dans le label.\n\n            FORMAT JSON ATTENDU :\n            {\n                \"electricite\": { \n                    \"valeurPrincipale\": \"X kWh\", \n                    \"pourcentage\": \"+X%%\", \n                    \"coutPrevu\": \"X MAD\", \n                    \"emissionCo2\": \"X kg CO2\",\n                    \"distribution\": [\n                        { \"label\": \"üè≠ Production\", \"value\": \"XX%%\" },\n                        { \"label\": \"üí° √âclairage\", \"value\": \"XX%%\" }\n                    ]\n                },\n                \"gaz\": { \n                    \"valeurPrincipale\": \"X kg\", \n                    \"pourcentage\": \"+X%%\", \n                    \"coutPrevu\": \"X MAD\", \n                    \"emissionCo2\": \"X kg CO2\",\n                    \"distribution\": [\n                        { \"label\": \"üî• Fours\", \"value\": \"XX%%\" },\n                        { \"label\": \"üöø Sanitaire\", \"value\": \"XX%%\" }\n                    ]\n                },\n                \"transport\": { \n                    \"valeurPrincipale\": \"X km\", \n                    \"pourcentage\": \"+X%%\", \n                    \"coutPrevu\": \"X MAD\", \n                    \"emissionCo2\": \"X kg CO2\",\n                    \"distribution\": [\n                         { \"label\": \"üöõ Logistique\", \"value\": \"XX%%\" },\n                         { \"label\": \"üöó Commercial\", \"value\": \"XX%%\" }\n                    ]\n                },\n                \"dechets\": { \n                    \"valeurPrincipale\": \"X kg\", \n                    \"pourcentage\": \"+X%%\", \n                    \"coutPrevu\": \"X MAD\", \n                    \"emissionCo2\": \"X kg CO2\",\n                    \"distribution\": [\n                        { \"label\": \"‚ôªÔ∏è Recyclable\", \"value\": \"XX%%\" },\n                        { \"label\": \"üóëÔ∏è Organique\", \"value\": \"XX%%\" }\n                    ]\n                }\n            }\n        \"\"\".formatted(prixElec, prixGaz, prixTransport, prixDechets, contextJson);\n    }\n}",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 71
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/PredictionService.java",
      "timestamp": 1765989569844,
      "startOffset": 1456,
      "endOffset": 1498,
      "codeContent": "private final AiPromptStore aiPromptStore;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/PredictionService.java",
      "timestamp": 1765989571600,
      "startOffset": 1474,
      "endOffset": 1517,
      "codeContent": "com.greentechinnovators.backend.service.ai.",
      "aiProbability": 70,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/PredictionService.java",
      "timestamp": 1765989571649,
      "startOffset": 797,
      "endOffset": 861,
      "codeContent": "import com.greentechinnovators.backend.service.ai.AiPromptStore;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/ChatService.java",
      "timestamp": 1765989657771,
      "startOffset": 379,
      "endOffset": 473,
      "codeContent": "import static com.greentechinnovators.backend.service.ai.AiPromptStore.SYSTEM_PROMPT_TEMPLATE;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "/_Dummy_.java",
      "timestamp": 1765989658235,
      "startOffset": 69,
      "endOffset": 100,
      "codeContent": "return SYSTEM_PROMPT_TEMPLATE;\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 2
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/ai/AiContextManager.java",
      "timestamp": 1765990243324,
      "startOffset": 1841,
      "endOffset": 2097,
      "codeContent": "LocalDateTime startOfMonth \u003d today.withDayOfMonth(1).atStartOfDay();\n        LocalDateTime now \u003d LocalDateTime.now();\n        LocalDateTime startOfLastMonth \u003d startOfMonth.minusMonths(1);\n        LocalDateTime endOfLastMonth \u003d startOfMonth.minusSeconds(1);",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 4
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/ai/AiContextManager.java",
      "timestamp": 1765990272188,
      "startOffset": 2658,
      "endOffset": 2678,
      "codeContent": "                    ",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/ai/AiContextManager.java",
      "timestamp": 1765990272192,
      "startOffset": 2785,
      "endOffset": 2805,
      "codeContent": "                    ",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/ai/AiContextManager.java",
      "timestamp": 1765990272196,
      "startOffset": 2910,
      "endOffset": 2930,
      "codeContent": "                    ",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/ai/AiContextManager.java",
      "timestamp": 1765990272200,
      "startOffset": 3043,
      "endOffset": 3063,
      "codeContent": "                    ",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/ai/AiContextManager.java",
      "timestamp": 1765990275785,
      "startOffset": 2566,
      "endOffset": 3046,
      "codeContent": "context.put(\\\"GAS\\\", getGasData(startOfMonth, now, startOfLastMonth, endOfLastMonth));\\n\" +\n\"        context.put(\\\"ENERGY\\\", getEnergyData(startOfMonth, now, startOfLastMonth, endOfLastMonth));\\n\" +\n\"        context.put(\\\"TRASH\\\", getTrashData(startOfMonth, now, startOfLastMonth, endOfLastMonth));\\n\" +\n\"        context.put(\\\"TRANSPORT\\\", getTransportData(startOfMonth, now, startOfLastMonth, endOfLastMonth));\\n\" +\n\"        context.put(\\\"DEPARTMENTS\\\", getDepartmentOverview());",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/ai/AiContextManager.java",
      "timestamp": 1765990275794,
      "startOffset": 3043,
      "endOffset": 3063,
      "codeContent": "                    ",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/ai/AiContextManager.java",
      "timestamp": 1765990275792,
      "startOffset": 2910,
      "endOffset": 2930,
      "codeContent": "                    ",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/ai/AiContextManager.java",
      "timestamp": 1765990275789,
      "startOffset": 2785,
      "endOffset": 2805,
      "codeContent": "                    ",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/repository/EnergyMonitorRepository.java",
      "timestamp": 1765991096113,
      "startOffset": 437,
      "endOffset": 513,
      "codeContent": "List\u003cEnergy\u003e findByCreatedAtBetween(LocalDateTime start, LocalDateTime end);",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/repository/EnergyMonitorRepository.java",
      "timestamp": 1765991104623,
      "startOffset": 233,
      "endOffset": 264,
      "codeContent": "import java.time.LocalDateTime;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "/EnergyMonitorRepository.java",
      "timestamp": 1765991107140,
      "startOffset": 469,
      "endOffset": 489,
      "codeContent": "IntellijIdeaRulezzz;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/repository/EnergyMonitorRepository.java",
      "timestamp": 1765991108124,
      "startOffset": 265,
      "endOffset": 287,
      "codeContent": "import java.util.List;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/EnergyService.java",
      "timestamp": 1765991470133,
      "startOffset": 6632,
      "endOffset": 7900,
      "codeContent": "public List\u003cEnergyResponseDTO\u003e getGlobalReadingsWithSources(LocalDateTime start, LocalDateTime end) {\n    // 1. Jib ga3 les monitors\n    List\u003cEnergyMonitor\u003e monitors \u003d monitorRepository.findAll();\n    \n    List\u003cEnergyResponseDTO\u003e globalList \u003d new ArrayList\u003c\u003e();\n\n    // 2. Boucli 3lihom w jma3 data\n    for (EnergyMonitor monitor : monitors) {\n        if (monitor.getEnergy() !\u003d null) {\n            \n            // Smiya d l-machine\n            String locationName \u003d monitor.getLocation(); \n\n            List\u003cEnergyResponseDTO\u003e monitorReadings \u003d monitor.getEnergy().stream()\n                .filter(e -\u003e e.getCreatedAt() !\u003d null \u0026\u0026 \n                             !e.getCreatedAt().isBefore(start) \u0026\u0026 \n                             !e.getCreatedAt().isAfter(end))\n                .map(e -\u003e EnergyResponseDTO.builder()\n                        .id(e.getId())\n                        .energyConsumed(e.getEnergyConsumed())\n                        .createdAt(e.getCreatedAt())\n                        \n                        // üî• Zid Smiya hna\n                        .source(locationName) \n                        .build())\n                .collect(Collectors.toList());\n            \n            globalList.addAll(monitorReadings);\n        }\n    }\n    return globalList;\n}",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 32
    },
    {
      "filePath": "/EnergyService.java",
      "timestamp": 1765991472871,
      "startOffset": 6651,
      "endOffset": 8024,
      "codeContent": "    public List\u003cEnergyResponseDTO\u003e getGlobalReadingsWithSources(LocalDateTime start, LocalDateTime end) {\n        // 1. Jib ga3 les monitors\n        List\u003cEnergyMonitor\u003e monitors \u003d monitorRepository.findAll();\n\n        List\u003cEnergyResponseDTO\u003e globalList \u003d new ArrayList\u003c\u003e();\n\n        // 2. Boucli 3lihom w jma3 data\n        for (EnergyMonitor monitor : monitors) {\n            if (monitor.getEnergy() !\u003d null) {\n\n                // Smiya d l-machine\n                String locationName \u003d monitor.getLocation();\n\n                List\u003cEnergyResponseDTO\u003e monitorReadings \u003d monitor.getEnergy().stream()\n                        .filter(e -\u003e e.getCreatedAt() !\u003d null \u0026\u0026\n                                !e.getCreatedAt().isBefore(start) \u0026\u0026\n                                !e.getCreatedAt().isAfter(end))\n                        .map(e -\u003e EnergyResponseDTO.builder()\n                                .id(e.getId())\n                                .energyConsumed(e.getEnergyConsumed())\n                                .createdAt(e.getCreatedAt())\n\n                                // üî• Zid Smiya hna\n                                .sourceIntellijIdeaRulezzz (locationName)\n                                .build())\n                        .collect(Collectors.toList());\n\n                globalList.addAll(monitorReadings);\n            }\n        }\n        return globalList;\n    }\n\n\n",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 35
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/EnergyService.java",
      "timestamp": 1765991898583,
      "startOffset": 5493,
      "endOffset": 5520,
      "codeContent": "\n                          ",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 2
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/EnergyService.java",
      "timestamp": 1765991898593,
      "startOffset": 5523,
      "endOffset": 5545,
      "codeContent": "   .source(sourceName)",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/EnergyService.java",
      "timestamp": 1765992016781,
      "startOffset": 5493,
      "endOffset": 5520,
      "codeContent": "\n                          ",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 2
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/EnergyService.java",
      "timestamp": 1765992016796,
      "startOffset": 5523,
      "endOffset": 5545,
      "codeContent": "   .source(sourceName)",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/EnergyService.java",
      "timestamp": 1765992017611,
      "startOffset": 4684,
      "endOffset": 4748,
      "codeContent": "            // 3. Kan-jbdo la liste d Energy dyal had l-monitor\n",
      "aiProbability": 70,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 2
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/EnergyService.java",
      "timestamp": 1765992018469,
      "startOffset": 4577,
      "endOffset": 4645,
      "codeContent": "            // Hna fin kan-akhdo smiya (Ex: \"Machine A\", \"Cuisine\")\n",
      "aiProbability": 70,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 2
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/EnergyService.java",
      "timestamp": 1765992019328,
      "startOffset": 4527,
      "endOffset": 4567,
      "codeContent": "        // 2. Kan-douzo 3la kol monitor\n",
      "aiProbability": 70,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 2
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/EnergyService.java",
      "timestamp": 1765992020318,
      "startOffset": 4397,
      "endOffset": 4498,
      "codeContent": "        // 1. Blast ma njibo Energy mchattata, kanjibo Monitors (hit huma li 3andhom Smiya/Location)\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 2
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/EnergyService.java",
      "timestamp": 1765992021267,
      "startOffset": 5163,
      "endOffset": 5228,
      "codeContent": "                            // Filtre dyal Date (kima kan 3ndek)\n",
      "aiProbability": 70,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 2
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/EnergyService.java",
      "timestamp": 1765992022224,
      "startOffset": 5831,
      "endOffset": 5938,
      "codeContent": "  // üî• HADI HIYA L-IDAFA L-MOHIMA:\n                                // Kan-injectiw smiya d l-monitor f DTO",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 2
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/EnergyService.java",
      "timestamp": 1765993220907,
      "startOffset": 1693,
      "endOffset": 6631,
      "codeContent": "        // Check if this is a manual entry - save directly without creating a monitor\n        if (\"MANUAL_ENTRY\".equals(macAddress)) {\n            return saveManualEntry(dto);\n        }\n\n        final String finalMacAddress \u003d macAddress;\n        Energy energy \u003d mapper.toEntity(dto);\n\n        // Find or create EnergyMonitor by MAC address\n        EnergyMonitor monitor \u003d monitorRepository.findByMacAddress(finalMacAddress)\n                .orElseGet(() -\u003e {\n                    log.info(\"Creating new EnergyMonitor for MAC address: {}\", finalMacAddress);\n                    EnergyMonitor newMonitor \u003d new EnergyMonitor();\n                    newMonitor.setMacAddress(finalMacAddress);\n                    newMonitor.setLocation(\"Auto-registered\");\n                    newMonitor.setSensorId(\"SENSOR-\" + finalMacAddress.replace(\":\", \"\"));\n                    newMonitor.setStatus(Status.ONLINE);\n                    newMonitor.setTimestamp(LocalDateTime.now());\n                    newMonitor.setEnergy(new ArrayList\u003c\u003e());\n                    return monitorRepository.save(newMonitor);\n                });\n\n        Energy res \u003d repository.save(energy);\n        monitor.getEnergy().add(res);\n        monitorRepository.save(monitor);\n        return mapper.toResponse(res);\n    }\n\n    /**\n     * Save manual entry directly to Energy collection without linking to a monitor.\n     * This keeps manual entries separate from IoT sensor data.\n     */\n    public EnergyResponseDTO saveManualEntry(EnergyRequestDTO dto) {\n        log.info(\"Saving manual energy entry: {} kWh\", dto.getEnergyConsumed());\n\n        Energy energy \u003d mapper.toEntity(dto);\n        // Ensure manual entries have a created date\n        if (energy.getCreatedAt() \u003d\u003d null) {\n            energy.setCreatedAt(LocalDateTime.now());\n        }\n        Energy savedEntity \u003d repository.save(energy);\n\n        log.info(\"Manual energy entry saved with ID: {}\", savedEntity.getId());\n        return mapper.toResponse(savedEntity);\n    }\n\n    public List\u003cEnergyResponseDTO\u003e getAllReadings() {\n        List\u003cEnergy\u003e energyList \u003d repository.findAll();\n        return energyList.stream().map(mapper::toResponse).toList();\n    }\n\n    public List\u003cEnergyResponseDTO\u003e getTodayReadings() {\n        LocalDateTime startOfToday \u003d LocalDateTime.now().toLocalDate().atStartOfDay();\n        LocalDateTime endOfToday \u003d startOfToday.plusDays(1);\n\n        List\u003cEnergy\u003e energyList \u003d repository.findAll().stream()\n                .filter(e -\u003e e.getCreatedAt() !\u003d null \u0026\u0026\n                        !e.getCreatedAt().isBefore(startOfToday) \u0026\u0026\n                        e.getCreatedAt().isBefore(endOfToday))\n                .toList();\n\n        return energyList.stream().map(mapper::toResponse).toList();\n    }\n\n    public List\u003cEnergyResponseDTO\u003e getConsumedKwhBetweenDates(LocalDateTime start, LocalDateTime end) {\n\n        List\u003cEnergy\u003e allEnergy \u003d repository.findAll();\n\n        return allEnergy.stream()\n                .filter(e -\u003e {\n                    if (e.getCreatedAt() \u003d\u003d null)\n                        return false;\n\n                    boolean isAfterStart \u003d !e.getCreatedAt().isBefore(start); // \u003e\u003d start\n                    boolean isBeforeEnd \u003d !e.getCreatedAt().isAfter(end); // \u003c\u003d end\n\n                    return isAfterStart \u0026\u0026 isBeforeEnd;\n                })\n                .map(e -\u003e EnergyResponseDTO.builder()\n                        .id(e.getId().toString())\n                        .energyConsumed(e.getEnergyConsumed())\n                        .createdAt(e.getCreatedAt())\n                        .build())\n                .collect(Collectors.toList());\n    }\n\n    public List\u003ccom.greentechinnovators.backend.dto.Energy.Responce.DailyEnergyDTO\u003e getDailyEnergy(LocalDateTime start,\n            LocalDateTime end) {\n        List\u003cEnergy\u003e allEnergy \u003d repository.findAll();\n        List\u003ccom.greentechinnovators.backend.dto.Energy.Responce.DailyEnergyDTO\u003e report \u003d new ArrayList\u003c\u003e();\n        LocalDateTime current \u003d start;\n\n        while (!current.isAfter(end)) {\n            LocalDateTime startOfDay \u003d current.toLocalDate().atStartOfDay();\n            LocalDateTime endOfDay \u003d startOfDay.plusDays(1);\n\n            double totalEnergy \u003d allEnergy.stream()\n                    .filter(e -\u003e e.getCreatedAt() !\u003d null \u0026\u0026\n                            !e.getCreatedAt().isBefore(startOfDay) \u0026\u0026\n                            e.getCreatedAt().isBefore(endOfDay))\n                    .mapToDouble(Energy::getEnergyConsumed)\n                    .sum();\n\n            double carbonFootprint \u003d carbonFootprintService.calculateEnergyFootprint(totalEnergy);\n\n            report.add(com.greentechinnovators.backend.dto.Energy.Responce.DailyEnergyDTO.builder()\n                    .date(current)\n                    .totalEnergyKwh(totalEnergy)\n                    .carbonFootprintKg(carbonFootprint)\n                    .build());\n\n            current \u003d current.plusDays(1);\n        }\n        return report;\n    }",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 115
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/ChatService.java",
      "timestamp": 1765993221073,
      "startOffset": 381,
      "endOffset": 1506,
      "codeContent": "@Service\n@RequiredArgsConstructor\npublic class ChatService {\n\n    private final AiContextManager contextManager;\n    private final DeepSeekClient deepSeekClient;\n\n    private static final String SYSTEM_PROMPT_TEMPLATE \u003d \"\"\"\n    Tu es l\u0027assistant IA de \u0027GreenTech Innovators\u0027.\n    \n    üö® R√îLE \u0026 LANGUE :\n    - Tu es un expert en efficacit√© √©nerg√©tique et d√©veloppement durable.\n    - Tu parles par d√©faut en Fran√ßais.\n    - ‚úÖ SI l\u0027utilisateur te parle en Darija (Marocain) ou demande \"bdarija\", TU DOIS r√©pondre en Darija.\n    \n    üìù R√àGLES DE FORMATAGE (R√âPONSE COURTE ET CLAIRE):\n    1. **Structure :** Utilise des sauts de ligne (\\\\n) pour s√©parer chaque id√©e.\n    2. **Titres :** Utilise **Titre** pour les titres.\n    3. **Listes :** Utilise des tirets (\"- \").\n    4. **Simplicit√© :** √âvite les caract√®res sp√©ciaux inutiles.\n    \n    ‚ÑπÔ∏è CONTEXTE DU PROJET :\n    - Objectif : -20%% co√ªts, -50%% CO2 d\u0027ici 2030.\n    \n    üìä DONN√âES TEMPS R√âEL (Mois courant vs Mois dernier) :\n    %s\n    \n    ‚õî INTERDICTIONS :\n    1. Pas de code informatique.\n    2. Pas d\u0027hallucination sur les chiffres (utilise le JSON fourni).\n    \"\"\";",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 31
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/ai/AiContextManager.java",
      "timestamp": 1765993221181,
      "startOffset": 581,
      "endOffset": 8750,
      "codeContent": "entity.Department;\nimport com.greentechinnovators.backend.entity.User;\nimport com.greentechinnovators.backend.service.*;\nimport com.greentechinnovators.backend.utils.AiDataHelper;\nimport com.greentechinnovators.backend.utils.CarbonFootprintService;\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.stereotype.Component;\n\nimport java.time.LocalDate;\nimport java.time.LocalDateTime;\nimport java.util.*;\n\n@Component\n@RequiredArgsConstructor\n@Slf4j\npublic class AiContextManager {\n\n    private final EnergyService energyService;\n    private final GasService gasService;\n    private final TrashService trashService;\n    private final VehicleService vehicleService;\n    private final ObjectMapper objectMapper;\n    private final AiDataHelper helper;\n    private final CarbonFootprintService carbonService;\n    private final DepartmentService departmentService;\n\n    /**\n     * Hada howa \"le cerveau\" li kayjma3 data mn ga3 les services.\n     * Kayraja3 JSON String clean bach DeepSeek yfhamha.\n     */\n    public String getGlobalContextJson() {\n        LocalDate today \u003d LocalDate.now();\n\n        LocalDateTime startOfMonth \u003d today.withDayOfMonth(1).atStartOfDay();\n        LocalDateTime now \u003d LocalDateTime.now();\n\n        LocalDateTime startOfLastMonth \u003d startOfMonth.minusMonths(1);\n        LocalDateTime endOfLastMonth \u003d startOfMonth.minusSeconds(1);\n\n        Map\u003cString, Object\u003e context \u003d new LinkedHashMap\u003c\u003e();\n\n        context.put(\"TRANSPORT\", getTransportData(startOfMonth, now, startOfLastMonth, endOfLastMonth));\n        context.put(\"TRASH\", getTrashData(startOfMonth, now, startOfLastMonth, endOfLastMonth));\n        context.put(\"ENERGY\", getEnergyData(startOfMonth, now, startOfLastMonth, endOfLastMonth));\n        context.put(\"GAS\", getGasData(startOfMonth, now, startOfLastMonth, endOfLastMonth));\n        context.put(\"DEPARTMENTS\", getDepartmentOverview());\n        try {\n            return objectMapper.writerWithDefaultPrettyPrinter().writeValueAsString(context);\n        } catch (JsonProcessingException e) {\n            log.error(\"Erreur f serialisation JSON context\", e);\n            return \"{}\";\n        }\n    }\n\n\n    private Map\u003cString, Object\u003e getTransportData(LocalDateTime start, LocalDateTime end, LocalDateTime lastStart, LocalDateTime lastEnd) {\n        try {\n            List\u003cDailyDistanceDTO\u003e currentLogs \u003d vehicleService.getDistanceHistory(start, end);\n            List\u003cDailyDistanceDTO\u003e lastLogs \u003d vehicleService.getDistanceHistory(lastStart, lastEnd);\n\n            double currentDist \u003d helper.calculateVehicleDistance(currentLogs);\n            double lastDist \u003d helper.calculateVehicleDistance(lastLogs);\n            double currentCo2 \u003d helper.calculateVehicleCarbon(currentLogs);\n            double lastCo2 \u003d helper.calculateVehicleCarbon(lastLogs);\n\n            return Map.of(\n                    \"Distance_Current\", String.format(Locale.US, \"%.2f km\", currentDist),\n                    \"Distance_LastMonth\", String.format(Locale.US, \"%.2f km\", lastDist),\n                    \"CO2_Current\", String.format(Locale.US, \"%.2f kg\", currentCo2),\n                    \"CO2_LastMonth\", String.format(Locale.US, \"%.2f kg\", lastCo2),\n                    \"Trend_CO2\", helper.getTrend(lastCo2, currentCo2)\n            );\n        } catch (Exception e) {\n            log.error(\"Erreur Transport Data\", e);\n            return Map.of(\"Status\", \"Donn√©es indisponibles\");\n        }\n    }\n    private Map\u003cString, Object\u003e getTrashData(LocalDateTime start, LocalDateTime end, LocalDateTime lastStart, LocalDateTime lastEnd) {\n        try {\n            List\u003cDailyTrashDTO\u003e currentWaste \u003d trashService.TrashCarbonFootprint(start, end);\n            List\u003cDailyTrashDTO\u003e lastWaste \u003d trashService.TrashCarbonFootprint(lastStart, lastEnd);\n\n            double currentWeight \u003d helper.calculateTrashWeight(currentWaste);\n            double currentCo2 \u003d helper.calculateTrashCarbon(currentWaste);\n            double lastCo2 \u003d helper.calculateTrashCarbon(lastWaste);\n\n            return Map.of(\n                    \"Total_Weight_Current\", String.format(Locale.US, \"%.2f kg\", currentWeight),\n                    \"CO2_Current\", String.format(Locale.US, \"%.2f kg\", currentCo2),\n                    \"CO2_LastMonth\", String.format(Locale.US, \"%.2f kg\", lastCo2),\n                    \"Trend_CO2\", helper.getTrend(lastCo2, currentCo2)\n            );\n        } catch (Exception e) {\n            log.error(\"Erreur Trash Data\", e);\n            return Map.of(\"Status\", \"Donn√©es indisponibles\");\n        }\n    }\n    private Map\u003cString, Object\u003e getEnergyData(LocalDateTime start, LocalDateTime end, LocalDateTime lastStart, LocalDateTime lastEnd) {\n        try {\n            List\u003cEnergyResponseDTO\u003e currentList \u003d energyService.getConsumedKwhBetweenDates(start, end);\n            List\u003cEnergyResponseDTO\u003e lastList \u003d energyService.getConsumedKwhBetweenDates(lastStart, lastEnd);\n\n            double currentKwh \u003d helper.calculateTotalEnergy(currentList);\n            double lastKwh \u003d helper.calculateTotalEnergy(lastList);\n\n            double currentCo2 \u003d carbonService.calculateEnergyFootprint(currentKwh);\n            double lastCo2 \u003d carbonService.calculateEnergyFootprint(lastKwh);\n\n            return Map.of(\n                    \"Consumption_Current\", String.format(Locale.US, \"%.2f kWh\", currentKwh),\n                    \"Consumption_LastMonth\", String.format(Locale.US, \"%.2f kWh\", lastKwh),\n                    \"Trend_Consumption\", helper.getTrend(lastKwh, currentKwh),\n                    \"CO2_Current\", String.format(Locale.US, \"%.2f kg\", currentCo2),\n                    \"CO2_LastMonth\", String.format(Locale.US, \"%.2f kg\", lastCo2),\n                    \"Trend_CO2\", helper.getTrend(lastCo2, currentCo2)\n            );\n        } catch (Exception e) {\n            log.warn(\"Erreur Energy Data: {}\", e.getMessage());\n            return Map.of(\"Status\", \"Donn√©es indisponibles\");\n        }\n    }\n    private Map\u003cString, Object\u003e getGasData(LocalDateTime start, LocalDateTime end, LocalDateTime lastStart, LocalDateTime lastEnd) {\n        try {\n            List\u003cGasResponseDTO\u003e currentList \u003d gasService.getConsumedGasBetweenDates(start, end);\n            List\u003cGasResponseDTO\u003e lastList \u003d gasService.getConsumedGasBetweenDates(lastStart, lastEnd);\n\n            double currentVal \u003d helper.calculateTotalGas(currentList);\n            double lastVal \u003d helper.calculateTotalGas(lastList);\n\n            double currentCo2 \u003d carbonService.calculateGasFootprint(currentVal);\n            double lastCo2 \u003d carbonService.calculateGasFootprint(lastVal);\n\n            return Map.of(\n                    \"Consumption_Current\", String.format(Locale.US, \"%.2f kg\", currentVal),\n                    \"Consumption_LastMonth\", String.format(Locale.US, \"%.2f kg\", lastVal),\n                    \"Trend_Gas\", helper.getTrend(lastVal, currentVal),\n                    \"CO2_Current\", String.format(Locale.US, \"%.2f kg\", currentCo2),\n                    \"CO2_LastMonth\", String.format(Locale.US, \"%.2f kg\", lastCo2),\n                    \"Trend_CO2\", helper.getTrend(lastCo2, currentCo2)\n            );\n        } catch (Exception e) {\n            log.error(\"Erreur Gas Data\", e);\n            return Map.of(\"Status\", \"Non configurer\");\n        }\n    }\n\n    private Map\u003cString, Object\u003e getDepartmentOverview() {\n        try {\n            List\u003cDepartmentResponseDTO\u003e departments \u003d departmentService.getAllDepartments();\n\n            List\u003cMap\u003cString, Object\u003e\u003e deptList \u003d new ArrayList\u003c\u003e();\n\n            for (DepartmentResponseDTO dept : departments) {\n                int userCount \u003d (dept.getUsers() !\u003d null) ? dept.getUsers().size() : 0;\n\n                Map\u003cString, Object\u003e info \u003d new HashMap\u003c\u003e();\n                info.put(\"Name\", dept.getName());\n                info.put(\"Employee_Count\", userCount);\n\n                deptList.add(info);\n            }\n\n\n            return Map.of(\n                    \"Total_Departments\", departments.size(),\n                    \"List\", deptList\n            );\n\n        } catch (Exception e) {\n            log.error(\"Erreur Department Data\", e);\n            return Map.of(\"Status\", \"Donn√©es indisponibles\");\n        }\n    }\n    ",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 175
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/controller/UserController.java",
      "timestamp": 1765993263727,
      "startOffset": 636,
      "endOffset": 3578,
      "codeContent": "import java.util.Map;\n\n@RestController\n@RequestMapping(\"/api/v1/users\")\n@RequiredArgsConstructor\n@CrossOrigin(origins \u003d \"*\")\npublic class UserController {\n\n    private final UserService userService;\n\n    @GetMapping\n    @PreAuthorize(\"hasRole(\u0027ADMIN\u0027)\")\n    public ResponseEntity\u003cList\u003cUserProfileDTO\u003e\u003e getAllUsers() {\n        return ResponseEntity.ok(userService.getAllUsers());\n    }\n\n    @PostMapping\n    @PreAuthorize(\"hasRole(\u0027ADMIN\u0027)\")\n    public ResponseEntity\u003cUserProfileDTO\u003e createUser(@Valid @RequestBody CreateUserRequestDTO request) {\n        return ResponseEntity.ok(userService.createUser(request));\n    }\n\n\n    @GetMapping(\"/{id}\")\n    public ResponseEntity\u003cUserProfileDTO\u003e getUserById(@PathVariable String id) {\n        return ResponseEntity.ok(userService.getUserById(id));\n    }\n\n\n    @GetMapping(\"/{id}/profile\")\n    public ResponseEntity\u003cUserProfileDTO\u003e getUserProfile(@PathVariable String id) {\n        return ResponseEntity.ok(userService.getUserProfile(id));\n    }\n\n\n    @PutMapping(\"/{id}\")\n    public ResponseEntity\u003cUserProfileDTO\u003e updateUser(\n            @PathVariable String id,\n            @Valid @RequestBody UpdateProfileRequestDTO request,\n            Authentication authentication) {\n\n        String authenticatedEmail \u003d authentication.getName();\n\n        UserProfileDTO targetUser \u003d userService.getUserById(id);\n\n        boolean isAdmin \u003d authentication.getAuthorities().stream()\n                .anyMatch(a -\u003e a.getAuthority().equals(\"ROLE_ADMIN\"));\n        if (!authenticatedEmail.equals(targetUser.getEmail()) \u0026\u0026 !isAdmin) {\n            return ResponseEntity.status(403).build();\n        }\n        \n        return ResponseEntity.ok(userService.updateUserProfile(id, request));\n    }\n\n\n    @PutMapping(\"/{id}/profile\")\n    public ResponseEntity\u003cUserProfileDTO\u003e updateUserProfile(\n            @PathVariable String id,\n            @Valid @RequestBody UpdateProfileRequestDTO request,\n            Authentication authentication) {\n\n        String authenticatedEmail \u003d authentication.getName();\n        UserProfileDTO targetUser \u003d userService.getUserById(id);\n\n        boolean isAdmin \u003d authentication.getAuthorities().stream()\n                .anyMatch(a -\u003e a.getAuthority().equals(\"ROLE_ADMIN\"));\n\n        if (!authenticatedEmail.equals(targetUser.getEmail()) \u0026\u0026 !isAdmin) {\n            return ResponseEntity.status(403).build();\n        }\n        \n        return ResponseEntity.ok(userService.updateUserProfile(id, request));\n    }\n\n    @PutMapping(\"/{userId}/password\")\n    public ResponseEntity\u003c?\u003e updatePassword(\n            @PathVariable String userId,\n            @RequestBody Map\u003cString, String\u003e passwords) {\n\n        String oldPassword \u003d passwords.get(\"oldPassword\");\n        String newPassword \u003d passwords.get(\"newPassword\");\n\n        userService.updatePassword(userId, oldPassword, newPassword);\n\n        return ResponseEntity.ok().body(Map.of(\"message\", \"Mot de passe mis √† jour avec succ√®s\"));\n    }",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 86
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/dto/ai/PredictionResponse.java",
      "timestamp": 1765993263735,
      "startOffset": 542,
      "endOffset": 1116,
      "codeContent": "    private List\u003cDistributionItem\u003e distribution;\n\n    }\n    public static class DistributionItem {\n        private String label;\n        private String value;\n\n        public DistributionItem() {}\n        public DistributionItem(String label, String value) {\n            this.label \u003d label;\n            this.value \u003d value;\n        }\n        public String getLabel() { return label; }\n        public void setLabel(String label) { this.label \u003d label; }\n        public String getValue() { return value; }\n        public void setValue(String value) { this.value \u003d value; }\n    }",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 17
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/UserService.java",
      "timestamp": 1765993263750,
      "startOffset": 3787,
      "endOffset": 6515,
      "codeContent": "    @Transactional\n    public void updatePassword(String userId, String oldPassword, String newPassword) {\n        User user \u003d userRepository.findById(userId)\n                .orElseThrow(() -\u003e new RuntimeException(\"User not found\"));\n\n        if (!passwordEncoder.matches(oldPassword, user.getPasswordHash())) {\n            throw new RuntimeException(\"Old password is incorrect\");\n        }\n\n        user.setPasswordHash(passwordEncoder.encode(newPassword));\n        user.setUpdatedAt(LocalDateTime.now());\n\n        userRepository.save(user);\n    }\n    public UserProfileDTO getUserById(String userId) {\n        User user \u003d userRepository.findById(userId)\n                .orElseThrow(() -\u003e new RuntimeException(\"User not found with id: \" + userId));\n        return mapToProfileDTO(user);\n    }\n\n\n    public UserProfileDTO getUserProfile(String userId) {\n        return getUserById(userId);\n    }\n\n\n    @Transactional\n    public UserProfileDTO updateUserProfile(String userId, UpdateProfileRequestDTO request) {\n        User user \u003d userRepository.findById(userId)\n                .orElseThrow(() -\u003e new RuntimeException(\"User not found with id: \" + userId));\n\n        // Update fields if provided\n        if (request.getName() !\u003d null \u0026\u0026 !request.getName().isBlank()) {\n            user.setName(request.getName());\n        }\n        \n        if (request.getEmail() !\u003d null \u0026\u0026 !request.getEmail().isBlank()) {\n            // Check if email is already taken by another user\n            userRepository.findByEmail(request.getEmail())\n                    .ifPresent(existingUser -\u003e {\n                        if (!existingUser.getId().equals(userId)) {\n                            throw new RuntimeException(\"Email is already in use\");\n                        }\n                    });\n            user.setEmail(request.getEmail());\n        }\n        \n        if (request.getDepartment() !\u003d null) {\n            user.setDepartment(request.getDepartment());\n        }\n        \n        if (request.getJobTitle() !\u003d null) {\n            user.setJobTitle(request.getJobTitle());\n        }\n        \n        if (request.getProfilePicture() !\u003d null) {\n            user.setProfilePicture(request.getProfilePicture());\n        }\n\n        user.setUpdatedAt(LocalDateTime.now());\n        User updatedUser \u003d userRepository.save(user);\n        \n        return mapToProfileDTO(updatedUser);\n    }\n\n\n    @Transactional\n    public void deleteUser(String userId) {\n        User user \u003d userRepository.findById(userId)\n                .orElseThrow(() -\u003e new RuntimeException(\"User not found with id: \" + userId));\n        \n        gamificationStatsRepository.findByUserId(userId)\n                .ifPresent(gamificationStatsRepository::delete);\n        ",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 74
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/service/PredictionService.java",
      "timestamp": 1765993263760,
      "startOffset": 141,
      "endOffset": 6155,
      "codeContent": "controller.DashboardController;\n\nimport com.greentechinnovators.backend.dto.Energy.Responce.DailyEnergyDTO;\nimport com.greentechinnovators.backend.dto.ai.PredictionResponse;\nimport com.greentechinnovators.backend.dto.gas.responce.DailyGasDTO;\nimport com.greentechinnovators.backend.dto.trash.response.DailyTrashDTO;\nimport com.greentechinnovators.backend.repository.EnergyRepository;\nimport com.greentechinnovators.backend.repository.GasRepository;\nimport com.greentechinnovators.backend.repository.TrashRepository;\nimport com.greentechinnovators.backend.repository.VehicleLogRepository;\nimport com.greentechinnovators.backend.service.ai.AiContextManager;\nimport com.greentechinnovators.backend.service.ai.AiPromptStore;\nimport com.greentechinnovators.backend.service.ai.DeepSeekClient;\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\n\nimport org.springframework.stereotype.Service;\nimport org.springframework.web.client.RestTemplate;\n\nimport java.time.LocalDateTime;\nimport java.util.ArrayList;\nimport java.util.HashMap;\nimport java.util.List;\nimport java.util.Map;\n\n@Slf4j\n@Service\n@RequiredArgsConstructor\npublic class PredictionService {\n\n    private final EnergyRepository energyRepository;\n    private final GasRepository gasRepository;\n    private final TrashRepository trashRepository;\n    private final VehicleLogRepository vehicleLogRepository;\n    private final AiPromptStore aiPromptStore;\n    private final AiContextManager aiContextManager;\n    private final RestTemplate restTemplate;\n    private final ObjectMapper objectMapper;\n\n    private final DeepSeekClient callDeepSeek;\n    private final DashboardController dashboardController;\n\n    private static final double PRIX_ELEC \u003d 1.20;       // MAD/kWh\n    private static final double PRIX_GAZ \u003d 12.50;       // MAD/kg\n    private static final double PRIX_TRANSPORT \u003d 14.00; // MAD/100km\n    private static final double PRIX_DECHETS \u003d 0.80;    // MAD/kg\n\n    public PredictionResponse generatePredictions() {\n        String contextJson \u003d aiContextManager.getGlobalContextJson();\n        String prompt \u003d aiPromptStore.getPredictionPrompt(\n                PRIX_ELEC,\n                PRIX_GAZ,\n                PRIX_TRANSPORT,\n                PRIX_DECHETS,\n                contextJson\n        );\n\n        String rawJson \u003d callDeepSeek.generate(prompt);\n        String cleanJson \u003d rawJson.replace(\"```json\", \"\").replace(\"```\", \"\").trim();\n\n        PredictionResponse response;\n        try {\n            response \u003d objectMapper.readValue(cleanJson, PredictionResponse.class);\n        } catch (Exception e) {\n            log.error(\"Erreur parsing Prediction\", e);\n            response \u003d new PredictionResponse();\n        }\n\n        LocalDateTime sevenDaysAgo \u003d LocalDateTime.now().minusDays(6).withHour(0).withMinute(0).withSecond(0).withNano(0);\n\n        if (response.getElectricite() \u003d\u003d null) response.setElectricite(new PredictionResponse.CategoryPrediction());\n        response.getElectricite().setHistory(getEnergyHistoryData(dashboardController.getEnergyHistory(7)));\n\n        if (response.getGaz() \u003d\u003d null) response.setGaz(new PredictionResponse.CategoryPrediction());\n        response.getGaz().setHistory(getGasHistoryData(dashboardController.getGasHistory(7)));\n\n//        if (response.getTransport() \u003d\u003d null) response.setTransport(new PredictionResponse.CategoryPrediction());\n//        response.getTransport().setHistory(getHistoryData(dashboardController.gett(sevenDaysAgo)));\n\n        if (response.getDechets() \u003d\u003d null) response.setDechets(new PredictionResponse.CategoryPrediction());\n        response.getDechets().setHistory(getTrashHistoryData(dashboardController.getTrashHistory(7)));\n\n        return response;\n    }\n\n\n\n    private List\u003cDouble\u003e getEnergyHistoryData(List\u003ccom.greentechinnovators.backend.dto.Energy.Responce.DailyEnergyDTO\u003e dbStats) {\n        Map\u003cString, Double\u003e statsMap \u003d new HashMap\u003c\u003e();\n\n        if (dbStats !\u003d null) {\n            for (DailyEnergyDTO stat : dbStats) {\n                statsMap.put(stat.getDate().toLocalDate().toString(), stat.getTotalEnergyKwh());\n            }\n        }\n\n        List\u003cDouble\u003e history \u003d new ArrayList\u003c\u003e();\n        LocalDateTime dateIter \u003d LocalDateTime.now().minusDays(6).withHour(0).withMinute(0).withSecond(0).withNano(0);\n\n        for (int i \u003d 0; i \u003c 7; i++) {\n            String key \u003d dateIter.toLocalDate().toString();\n            history.add(statsMap.getOrDefault(key, 0.0));\n            dateIter \u003d dateIter.plusDays(1);\n        }\n        return history;\n    }\n\n    private List\u003cDouble\u003e getTrashHistoryData(List\u003cDailyTrashDTO\u003e dbStats) {\n        Map\u003cString, Double\u003e statsMap \u003d new HashMap\u003c\u003e();\n\n        if (dbStats !\u003d null) {\n            for (DailyTrashDTO stat : dbStats) {\n                statsMap.put(stat.getDate().toLocalDate().toString(), stat.getTotalWeightKg());\n            }\n        }\n\n        List\u003cDouble\u003e history \u003d new ArrayList\u003c\u003e();\n        LocalDateTime dateIter \u003d LocalDateTime.now().minusDays(6).withHour(0).withMinute(0).withSecond(0).withNano(0);\n\n        for (int i \u003d 0; i \u003c 7; i++) {\n            String key \u003d dateIter.toLocalDate().toString();\n            history.add(statsMap.getOrDefault(key, 0.0));\n            dateIter \u003d dateIter.plusDays(1);\n        }\n        return history;\n    }\n\n    private List\u003cDouble\u003e getGasHistoryData(List\u003cDailyGasDTO\u003e dbStats) {\n        Map\u003cString, Double\u003e statsMap \u003d new HashMap\u003c\u003e();\n\n        if (dbStats !\u003d null) {\n            for (DailyGasDTO stat : dbStats) {\n                statsMap.put(stat.getDate().toLocalDate().toString(), stat.getCarbonFootprintKg());\n            }\n        }\n\n        List\u003cDouble\u003e history \u003d new ArrayList\u003c\u003e();\n        LocalDateTime dateIter \u003d LocalDateTime.now().minusDays(6).withHour(0).withMinute(0).withSecond(0).withNano(0);\n\n        for (int i \u003d 0; i \u003c 7; i++) {\n            String key \u003d dateIter.toLocalDate().toString();\n            history.add(statsMap.getOrDefault(key, 0.0));\n            dateIter \u003d dateIter.plusDays(1);\n        }\n        return history;\n    }\n\n",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 148
    },
    {
      "filePath": "C:/Users/safiy/Documents/OneDrive/Bureau/GreenTech-V2/GreenTech-V2/src/main/java/com/greentechinnovators/backend/repository/EnergyMonitorRepository.java",
      "timestamp": 1765993263768,
      "startOffset": 245,
      "endOffset": 569,
      "codeContent": "time.LocalDateTime;\nimport java.util.List;\nimport java.util.Optional;\n\n@Repository\npublic interface EnergyMonitorRepository extends MongoRepository\u003cEnergyMonitor, String\u003e {\n    Optional\u003cEnergyMonitor\u003e findByMacAddress(String macAddress);\n\n    List\u003cEnergyMonitor\u003e findByTimestampBetween(LocalDateTime start, LocalDateTime end",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 9
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/config.java",
      "timestamp": 1766395549555,
      "startOffset": 0,
      "endOffset": 51,
      "codeContent": "package com.savt.backend;\n\npublic class config {\n}\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/domain.java",
      "timestamp": 1766395628510,
      "startOffset": 0,
      "endOffset": 51,
      "codeContent": "package com.savt.backend;\n\npublic class domain {\n}\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/application/SecurityConfig.java",
      "timestamp": 1766395660572,
      "startOffset": 0,
      "endOffset": 71,
      "codeContent": "package com.savt.backend.application;\n\npublic class SecurityConfig {\n}\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/application/CorsConfig.java",
      "timestamp": 1766395681762,
      "startOffset": 0,
      "endOffset": 67,
      "codeContent": "package com.savt.backend.application;\n\npublic class CorsConfig {\n}\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/shared/exception/GlobalExceptionHandler.java",
      "timestamp": 1766395707127,
      "startOffset": 0,
      "endOffset": 84,
      "codeContent": "package com.savt.backend.shared.exception;\n\npublic class GlobalExceptionHandler {\n}\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/shared/exception/response.java",
      "timestamp": 1766395719773,
      "startOffset": 0,
      "endOffset": 70,
      "codeContent": "package com.savt.backend.shared.exception;\n\npublic class response {\n}\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/auth/controller/AuthController.java",
      "timestamp": 1766395766549,
      "startOffset": 0,
      "endOffset": 75,
      "codeContent": "package com.savt.backend.auth.controller;\n\npublic class AuthController {\n}\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/auth/dto/LoginRequest.java",
      "timestamp": 1766396858606,
      "startOffset": 0,
      "endOffset": 66,
      "codeContent": "package com.savt.backend.auth.dto;\n\npublic class LoginRequest {\n}\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/auth/dto/RegisterRequest.java",
      "timestamp": 1766396867838,
      "startOffset": 0,
      "endOffset": 69,
      "codeContent": "package com.savt.backend.auth.dto;\n\npublic class RegisterRequest {\n}\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/auth/service/AuthService.java",
      "timestamp": 1766396906474,
      "startOffset": 0,
      "endOffset": 69,
      "codeContent": "package com.savt.backend.auth.service;\n\npublic class AuthService {\n}\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/auth/repository.java",
      "timestamp": 1766396915641,
      "startOffset": 0,
      "endOffset": 60,
      "codeContent": "package com.savt.backend.auth;\n\npublic class repository {\n}\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/auth/repository/UserRepository.java",
      "timestamp": 1766396957441,
      "startOffset": 0,
      "endOffset": 75,
      "codeContent": "package com.savt.backend.auth.repository;\n\npublic class UserRepository {\n}\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/domain/VideoAnalysis.java",
      "timestamp": 1766397171484,
      "startOffset": 0,
      "endOffset": 65,
      "codeContent": "package com.savt.backend.domain;\n\npublic class VideoAnalysis {\n}\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/domain/PositionData.java",
      "timestamp": 1766397178465,
      "startOffset": 0,
      "endOffset": 64,
      "codeContent": "package com.savt.backend.domain;\n\npublic class PositionData {\n}\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/domain/MatchEvent.java",
      "timestamp": 1766397185960,
      "startOffset": 0,
      "endOffset": 62,
      "codeContent": "package com.savt.backend.domain;\n\npublic class MatchEvent {\n}\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/domain/repository/AnalysisRepository.java",
      "timestamp": 1766397311171,
      "startOffset": 0,
      "endOffset": 81,
      "codeContent": "package com.savt.backend.domain.repository;\n\npublic class AnalysisRepository {\n}\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/application/dto/AnalysisResultDTO.java",
      "timestamp": 1766397523161,
      "startOffset": 0,
      "endOffset": 78,
      "codeContent": "package com.savt.backend.application.dto;\n\npublic class AnalysisResultDTO {\n}\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/application/dto/FrameDataDTO.java",
      "timestamp": 1766397530273,
      "startOffset": 0,
      "endOffset": 73,
      "codeContent": "package com.savt.backend.application.dto;\n\npublic class FrameDataDTO {\n}\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/application/mapper/PositionMapper.java",
      "timestamp": 1766397554519,
      "startOffset": 0,
      "endOffset": 78,
      "codeContent": "package com.savt.backend.application.mapper;\n\npublic class PositionMapper {\n}\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/application/service/AnalysisService.java",
      "timestamp": 1766397576725,
      "startOffset": 0,
      "endOffset": 80,
      "codeContent": "package com.savt.backend.application.service;\n\npublic class AnalysisService {\n}\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/application/service/impl/AnalysisServiceImpl.java",
      "timestamp": 1766397607917,
      "startOffset": 0,
      "endOffset": 89,
      "codeContent": "package com.savt.backend.application.service.impl;\n\npublic class AnalysisServiceImpl {\n}\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/auth/domain/Utilisateur.java",
      "timestamp": 1766397974515,
      "startOffset": 0,
      "endOffset": 68,
      "codeContent": "package com.savt.backend.auth.domain;\n\npublic class Utilisateur {\n}\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/config/AuthInterceptor.java",
      "timestamp": 1766398107446,
      "startOffset": 0,
      "endOffset": 67,
      "codeContent": "package com.savt.backend.config;\n\npublic class AuthInterceptor {\n}\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/config/AuthInterceptor.java",
      "timestamp": 1766398116058,
      "startOffset": 13,
      "endOffset": 2476,
      "codeContent": "martshop.presontation.config;\n\nimport com.smartshop.domain.Exception.ForbiddenException;\nimport com.smartshop.domain.Exception.UnauthorizedException;\nimport jakarta.servlet.http.HttpServletRequest;\nimport jakarta.servlet.http.HttpServletResponse;\nimport jakarta.servlet.http.HttpSession;\nimport org.springframework.stereotype.Component;\nimport org.springframework.web.servlet.HandlerInterceptor;\n\nimport static com.smartshop.presontation.controller.AuthController.USER_ID_KEY;\nimport static com.smartshop.presontation.controller.AuthController.USER_ROLE_KEY;\n\n@Component\npublic class AuthInterceptor implements HandlerInterceptor {\n\n    @Override\n    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {\n\n        String requestPath \u003d request.getRequestURI();\n\n        if (requestPath.startsWith(\"/api/auth\")) {\n            return true;\n        }\n\n        HttpSession session \u003d request.getSession(false);\n\n        if (session \u003d\u003d null || session.getAttribute(USER_ID_KEY) \u003d\u003d null) {\n            throw new UnauthorizedException(\"Session expir√©e ou non authentifi√©. Veuillez vous connecter.\");\n        }\n\n        Object roleObj \u003d session.getAttribute(USER_ROLE_KEY);\n        String userRle \u003d (roleObj !\u003d null) ? roleObj.toString() : \"\";\n\n        if (requestPath.startsWith(\"/api/clients\") ||\n                requestPath.startsWith(\"/api/products\") ||\n                requestPath.startsWith(\"/api/commandes\") ||\n                requestPath.startsWith(\"/api/paiements\")) {\n\n            if (\"CLIENT\".equals(userRle)) {\n\n                if (!request.getMethod().equalsIgnoreCase(\"GET\")) {\n                    throw new ForbiddenException(\"Acc√®s refus√©. Mode lecture seule pour les CLIENTS.\");\n                }\n\n\n                if (requestPath.equals(\"/api/clients\")) {\n                    throw new ForbiddenException(\"Acc√®s refus√©. Vous ne pouvez pas consulter la liste des autres clients.\");\n                }\n                if (requestPath.startsWith(\"/api/commandes\")) {\n                    boolean isMyOrdersEndpoint \u003d requestPath.contains(\"/my_orders\");\n                    if (\"GET\".equalsIgnoreCase(request.getMethod()) \u0026\u0026 isMyOrdersEndpoint) {\n                        return true;\n                    }\n                    throw new ForbiddenException(\"Acc√®s refus√©. Les clients ne peuvent pas consulter l\u0027historique.\");\n                }\n            }\n\n\n        }\n\n        return true;\n    }\n}",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 64
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/shared/exception/GlobalExceptionHandler.java",
      "timestamp": 1766398212577,
      "startOffset": 13,
      "endOffset": 4581,
      "codeContent": "martshop.presontation.config;\n\nimport com.smartshop.domain.Exception.*;\nimport jakarta.servlet.http.HttpServletRequest;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.http.HttpStatus;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.HttpRequestMethodNotSupportedException;\nimport org.springframework.web.bind.MethodArgumentNotValidException;\nimport org.springframework.web.bind.annotation.ControllerAdvice;\nimport org.springframework.web.bind.annotation.ExceptionHandler;\n\nimport java.time.LocalDateTime;\nimport java.util.LinkedHashMap;\nimport java.util.Map;\nimport java.util.stream.Collectors;\n\n@ControllerAdvice\npublic class GlobalExceptionHandler {\n    private static final Logger logger \u003d LoggerFactory.getLogger(GlobalExceptionHandler.class);\n\n    private ResponseEntity\u003cMap\u003cString, Object\u003e\u003e buildResponse(HttpStatus status, String errorType, String message, String path) {\n        Map\u003cString, Object\u003e body \u003d new LinkedHashMap\u003c\u003e();\n        body.put(\"timestamp\", LocalDateTime.now().toString());\n        body.put(\"status\", status.value());\n        body.put(\"error\", errorType);\n        body.put(\"message\", message);\n        body.put(\"path\", path);\n        return new ResponseEntity\u003c\u003e(body, status);\n    }\n\n    @ExceptionHandler(UnauthorizedException.class)\n    public ResponseEntity\u003cMap\u003cString, Object\u003e\u003e handleInvalidCredentialsErrors(UnauthorizedException ex, HttpServletRequest request) {\n        return buildResponse(HttpStatus.UNAUTHORIZED, \"UNAUTHORIZED\", ex.getMessage(), request.getRequestURI());\n    }\n\n    @ExceptionHandler(ResourceNotFoundException.class)\n    public ResponseEntity\u003cMap\u003cString, Object\u003e\u003e handleNotFoundException(ResourceNotFoundException ex, HttpServletRequest request) {\n        return buildResponse(HttpStatus.NOT_FOUND, \"NOT_FOUND\", ex.getMessage(), request.getRequestURI());\n    }\n    @ExceptionHandler(HttpRequestMethodNotSupportedException.class)\n    public ResponseEntity\u003cMap\u003cString, Object\u003e\u003e handleHttpRequestMethodNotSupportedException(HttpRequestMethodNotSupportedException ex, HttpServletRequest request) {\n        return buildResponse(HttpStatus.HTTP_VERSION_NOT_SUPPORTED, \"HTTP_VERSION_NOT_SUPPORTED\", ex.getMessage(), request.getRequestURI());\n    }\n\n    @ExceptionHandler(InvalidOrderStateException.class)\n    public ResponseEntity\u003cMap\u003cString, Object\u003e\u003e handleInvalidState(InvalidOrderStateException ex, HttpServletRequest request) {\n        return buildResponse(HttpStatus.UNPROCESSABLE_ENTITY, \"BUSINESS_RULE_VIOLATION\", ex.getMessage(), request.getRequestURI());\n    }\n\n    @ExceptionHandler(MethodArgumentNotValidException.class)\n    public ResponseEntity\u003cMap\u003cString, Object\u003e\u003e handleValidationExceptions(MethodArgumentNotValidException ex, HttpServletRequest request) {\n        String errorMessage \u003d ex.getBindingResult().getFieldErrors().stream()\n                .map(error -\u003e error.getField() + \": \" + error.getDefaultMessage())\n                .collect(Collectors.joining(\"; \"));\n        return buildResponse(HttpStatus.BAD_REQUEST, \"VALIDATION_ERROR\", errorMessage, request.getRequestURI());\n    }\n    @ExceptionHandler(CustomValidationException.class)\n    public ResponseEntity\u003cMap\u003cString, Object\u003e\u003e handleCustomValidation(CustomValidationException ex, HttpServletRequest request) {\n        return buildResponse(HttpStatus.BAD_REQUEST, \"VALIDATION_ERROR\", ex.getMessage(), request.getRequestURI());\n    }\n\n    @ExceptionHandler(handleValidationCodePromoException.class)\n    public ResponseEntity\u003cMap\u003cString, Object\u003e\u003e handleValidationCodePromoException(handleValidationCodePromoException ex, HttpServletRequest request) {\n        logger.error(\"Unexpected error occurred: {}\", ex.getMessage(), ex);\n        return buildResponse(HttpStatus.BAD_REQUEST, \"CODE PROMO INVALIDE\", ex.getMessage(), request.getRequestURI());\n    }\n\n    @ExceptionHandler(RuntimeException.class)\n    public ResponseEntity\u003cMap\u003cString, Object\u003e\u003e handleRuntimeException(RuntimeException ex, HttpServletRequest request) {\n        logger.error(\"Unexpected error occurred: {}\", ex.getMessage(), ex);\n        return buildResponse(HttpStatus.INTERNAL_SERVER_ERROR, \"INTERNAL_SERVER_ERROR\", ex.getMessage(), request.getRequestURI());\n    }\n\n\n    @ExceptionHandler(ForbiddenException.class)\n    public ResponseEntity\u003cMap\u003cString, Object\u003e\u003e handleForbiddenException(Exception ex, HttpServletRequest request) {\n        logger.error(\"Forbidden error: {}\", ex.getMessage(), ex);\n        return buildResponse(HttpStatus.FORBIDDEN, \"FORBIDDEN\", ex.getMessage(), request.getRequestURI());\n    }\n}",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 82
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/config/WebMvcConfig.java",
      "timestamp": 1766398242784,
      "startOffset": 0,
      "endOffset": 64,
      "codeContent": "package com.savt.backend.config;\n\npublic class WebMvcConfig {\n}\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/config/WebMvcConfig.java",
      "timestamp": 1766398247677,
      "startOffset": 13,
      "endOffset": 876,
      "codeContent": "martshop.presontation.config;\n\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.web.servlet.config.annotation.InterceptorRegistry;\nimport org.springframework.web.servlet.config.annotation.WebMvcConfigurer;\n\n@Configuration\npublic class WebMvcConfig implements WebMvcConfigurer {\n    private final AuthInterceptor authInterceptor;\n\n    public WebMvcConfig(AuthInterceptor authInterceptor) {\n        this.authInterceptor \u003d authInterceptor;\n    }\n    public void addInterceptors(InterceptorRegistry registry){\n        registry.addInterceptor(authInterceptor)\n                .addPathPatterns(\"/api/**\")\n                .excludePathPatterns(\n                        \"/api/auth/login\",\n                        \"/api/auth/logout\",\n                        \"/error\",\n                        \"/swagger-ui/**\"\n                );\n\n    }",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 24
    },
    {
      "filePath": "/AuthInterceptor.java",
      "timestamp": 1766398380725,
      "startOffset": 876,
      "endOffset": 941,
      "codeContent": "(\"Session expir√©e ou non authentifi√©. Veuillez vous connecter.\");",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/shared/exception/UnauthorizedException.java",
      "timestamp": 1766398402232,
      "startOffset": 0,
      "endOffset": 181,
      "codeContent": "package com.savt.backend.shared.exception;\n\npublic class UnauthorizedException extends RuntimeException {\n  public UnauthorizedException(String message) {\n    super(message);\n  }\n}\n",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 8
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/config/AuthInterceptor.java",
      "timestamp": 1766398411903,
      "startOffset": 34,
      "endOffset": 97,
      "codeContent": "import com.savt.backend.shared.exception.UnauthorizedException;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/shared/exception/ForbiddenException.java",
      "timestamp": 1766398425139,
      "startOffset": 0,
      "endOffset": 80,
      "codeContent": "package com.savt.backend.shared.exception;\n\npublic class ForbiddenException {\n}\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/shared/exception/ForbiddenException.java",
      "timestamp": 1766398451567,
      "startOffset": 0,
      "endOffset": 80,
      "codeContent": "package com.savt.backend.shared.exception;\n\npublic class ForbiddenException {\n}\n",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 5
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/shared/exception/ForbiddenException.java",
      "timestamp": 1766398469792,
      "startOffset": 0,
      "endOffset": 175,
      "codeContent": "package com.savt.backend.shared.exception;\n\npublic class ForbiddenException extends RuntimeException {\n  public ForbiddenException(String message) {\n    super(message);\n  }\n}\n",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 8
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/main/java/com/savt/backend/config/AuthInterceptor.java",
      "timestamp": 1766398483480,
      "startOffset": 34,
      "endOffset": 94,
      "codeContent": "import com.savt.backend.shared.exception.ForbiddenException;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/test/java/com/savt/backend/SavtBackendApplicationTests.java",
      "timestamp": 1766400854259,
      "startOffset": 181,
      "endOffset": 233,
      "codeContent": "@MockBean\n    private EmbeddingModel embeddingModel;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 2
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/test/java/com/savt/backend/SavtBackendApplicationTests.java",
      "timestamp": 1766400857458,
      "startOffset": 62,
      "endOffset": 117,
      "codeContent": "import org.springframework.ai.embedding.EmbeddingModel;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "/SavtBackendApplicationTests.java",
      "timestamp": 1766400860735,
      "startOffset": 246,
      "endOffset": 266,
      "codeContent": "IntellijIdeaRulezzz ",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/test/java/com/savt/backend/SavtBackendApplicationTests.java",
      "timestamp": 1766400862848,
      "startOffset": 178,
      "endOffset": 237,
      "codeContent": "import org.springframework.boot.test.mock.mockito.MockBean;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/test/java/com/savt/backend/SavtBackendApplicationTests.java",
      "timestamp": 1766400906669,
      "startOffset": 258,
      "endOffset": 291,
      "codeContent": "org.springframework.ai.embedding.",
      "aiProbability": 70,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/test/java/com/savt/backend/SavtBackendApplicationTests.java",
      "timestamp": 1766400921167,
      "startOffset": 141,
      "endOffset": 180,
      "codeContent": "org.springframework.boot.autoconfigure.",
      "aiProbability": 70,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/test/java/com/savt/backend/SavtBackendApplicationTests.java",
      "timestamp": 1766400921189,
      "startOffset": 62,
      "endOffset": 132,
      "codeContent": "import org.springframework.boot.autoconfigure.EnableAutoConfiguration;",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/safiy/Downloads/savt-backend/backend/src/test/java/com/savt/backend/SavtBackendApplicationTests.java",
      "timestamp": 1766400925676,
      "startOffset": 62,
      "endOffset": 167,
      "codeContent": "import org.springframework.ai.vectorstore.mongodb.autoconfigure.MongoDBAtlasVectorStoreAutoConfiguration;",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    }
  ],
  "toolStats": {
    "AI Assistant": {
      "usageCount": 196,
      "totalLines": 2757
    }
  }
}